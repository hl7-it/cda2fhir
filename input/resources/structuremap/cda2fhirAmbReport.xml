<StructureMap xmlns="http://hl7.org/fhir">
   <id value="cda2fhirAmbReport"/>
   <text>
      <status value="generated"/>
      <div xmlns="http://www.w3.org/1999/xhtml">
         <pre>map &quot;http://hl7.it/fhir/cda2fhir/StructureMap/cda2fhirAmbReport&quot; = &quot;cda2fhirAmbReport&quot;

uses &quot;http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument&quot; alias ClinicalDocument as source
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor&quot; alias AssignedAuthor as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity&quot; alias AssignedEntity as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/AssociatedEntity&quot; alias AssociatedEntity as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization&quot; alias CustodianOrganization as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/OrganizationPartOf&quot; alias OrganizationPartOf as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/Organization&quot; alias rapresentedOrganization as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/Section&quot; alias Section as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/PatientRole&quot; alias PatientRole as queried
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/AD&quot; alias AD as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias Bundle as target
uses &quot;http://hl7.org/fhir/StructureDefinition/Composition&quot; alias Composition as produced
uses &quot;http://hl7.org/fhir/StructureDefinition/Patient&quot; alias Patient as produced
uses &quot;http://hl7.org/fhir/StructureDefinition/Encounter&quot; alias Encounter as produced
uses &quot;http://hl7.org/fhir/StructureDefinition/Person&quot; alias Patient as produced
uses &quot;http://hl7.org/fhir/StructureDefinition/List&quot; alias List as produced
uses &quot;http://hl7.org/fhir/StructureDefinition/Practitioner&quot; alias Practitioner as produced
uses &quot;http://hl7.org/fhir/StructureDefinition/Organization&quot; alias Organization as produced
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/Act&quot; alias Act as produced
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/IVL-PQ&quot; alias IVL_PQ as source
uses &quot;http://hl7.org/fhir/cda/StructureDefinition/PQ&quot; alias PQ as source
uses &quot;http://hl7.org/fhir/StructureDefinition/SimpleQuantity&quot; alias SimpleQuantity as target

imports &quot;http://hl7.it/fhir/cda2fhir/StructureMap/cda2fhirDataTypes&quot;
imports &quot;http://hl7.it/fhir/cda2fhir/StructureMap/cda2fhirHeader&quot;

group CdaToBundle(source cda : ClinicalDocument, target bundle : Bundle) {
  cda -&gt;  bundle.entry as e,  e.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e.resource = create(&apos;Composition&apos;) as composition,  composition.id = uuid() as uuid1,  e.fullUrl = append(&apos;https://example/Composition/&apos;, uuid1),  request.url = &apos;Composition&apos;,  bundle.entry as e2,  e2.request = create('BackboneElement') as requestPAT,  requestPAT.method = 'PUT',  e2.resource = create('Patient') as patient,  patient.id = uuid() as uuid2,  e2.fullUrl = append('https://example/Patient/', uuid2),  bundle.entry as e3,  e3.request = create('BackboneElement') as request,  request.method = 'POST',  e3.resource = create('Encounter') as encounter,  encounter.id = uuid() as uuid3,  e3.fullUrl = append('https://example/Encounter/', uuid3),  request.url = 'Encounter',  bundle.entry as e4,  e4.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e4.resource = create(&apos;DocumentReference&apos;) as DocumentReference,  DocumentReference.id = uuid() as uuid4,  e4.fullUrl = append(&apos;https://example/DocumentReference/&apos;, uuid4),  request.url = &apos;DocumentReference&apos; then {
    cda then ClinicalDocumentToBundle(cda, patient, composition, encounter, bundle, DocumentReference) &quot;cdatobundle&quot;;
    cda.recordTarget as recordTarget then {
      recordTarget.patientRole as patient then {
        patient.id as id -&gt; patient.identifier as identifier then {
          id.root as r -&gt; identifier.system = translate(r, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;) &quot;root1&quot;;
          id.extension as ext1 -&gt; identifier.value = ext1 &quot;value&quot;;
          id.assigningAuthorityName as s -&gt;  identifier.assigner as a,  a.display = s;
        } &quot;idfr&quot;;
        patient.id as id where (root = &apos;2.16.840.1.113883.2.9.4.3.2&apos;) or (root = &apos;2.16.840.1.113883.2.9.4.3.7&apos;) or (root = &apos;2.16.840.1.113883.2.9.4.3.3&apos;) or (root = &apos;2.16.840.1.113883.2.9.4.3.17&apos;) or (root = &apos;2.16.840.1.113883.2.9.4.3.15&apos;) then {
          id.extension as ext -&gt; requestPAT.url = append(&apos;Patient?identifier=&apos;, ext) &quot;UUID&quot;;
        } &quot;record&quot;;
      } &quot;recPat&quot;;
    } &quot;patient&quot;;
  } &quot;ClinicalDocumentToBody&quot;;
}

group ClinicalDocumentToBundle(source cda : ClinicalDocument, target patient : Patient, target composition : Composition, target encounter : Encounter, target bundle : Bundle, target DocumentReference : DocumentReference) {
  cda -&gt; bundle.id = uuid() &quot;id&quot;;
  cda.id -&gt; bundle.identifier &quot;identifier&quot;;
  cda -&gt; bundle.type = &apos;transaction&apos; &quot;type&quot;;
  cda -&gt; bundle.timestamp = (timestamp.now()) &quot;date&quot;;
  cda then ClinicalDocumentComposition(cda, composition, patient, encounter, bundle, DocumentReference) &quot;composition&quot;;
  cda -&gt;  bundle.entry as e,  e.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e.resource = create(&apos;DiagnosticReport&apos;) as diagnosticReport,  diagnosticReport.id = uuid() as uuid1,  e.fullUrl = append(&apos;https://example/DiagnosticReport/&apos;, uuid1),  request.url = &apos;DiagnosticReport&apos; then {
    cda.code -&gt; diagnosticReport.code &quot;diagnosticCode&quot;;
    cda -&gt; diagnosticReport.status = &apos;registered&apos; &quot;stats&quot;;
    cda.component as component then {
      component.structuredBody as body then {
        body.component as component then {
          component.section as srcSection then {
            srcSection.code -&gt; composition.section as tgtSection then ClinicalDocumentSection(cda, srcSection, patient, tgtSection, bundle, encounter, diagnosticReport);
          };
        };
      } &quot;body&quot;;
    };
  } &quot;diagnostic&quot;;
}

group ClinicalDocumentSection(source cda : ClinicalDocument, source src : Section, target patient : Patient, target tgt, target bundle : Bundle, target enc : Encounter, target dReport : DiagnosticReport) {
  src.title as t -&gt; tgt.title = (t.dataString);
  src.code -&gt; tgt.code;
  src -&gt;  tgt.entry = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/DiagnosticReport/&apos; + %dReport.id) &quot;reference&quot;;
  src.entry as entry then {
    src.text as cdaText -&gt; tgt.text as fhirText then {
      cdaText -&gt; fhirText.status = &apos;generated&apos; &quot;narrativeStatus&quot;;
      cdaText as t -&gt; fhirText.div = t &quot;narrativeText&quot;;
    } &quot;cdaText&quot;;
    entry then DiagnosticReportFunction(src, entry, dReport, bundle, enc, patient) &quot;dreport&quot;;
  };
  src where src.entry.exists().not() then DiagnosticReportFunction(src, cda, dReport, bundle, enc, patient) &quot;narrative&quot;;
  src.component as component then {
    component.section as sec -&gt; tgt.section as tgtSection then ClinicalDocumentSection(cda, sec, patient, tgtSection, bundle, enc, dReport);
  };
}

group DiagnosticReportFunction(source section : section, source src : entry, target dReport : DiagnosticReport, target bundle : Bundle, target encounter : Encounter, target patient : Patient) {
  src.observation as observation then {
    section where code.code = &apos;29299-5&apos; -&gt;  bundle.entry as e1,  e1.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e1.resource = create(&apos;Observation&apos;) as obs1,  obs1.id = uuid() as uuid1,  e1.fullUrl = append(&apos;https://example/Observation/&apos;, uuid1),  request.url = &apos;Observation&apos;,  dReport.result = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs1.id) then Observation(observation, patient, encounter, obs1, bundle) &quot;QuesitoDiagnostico&quot;;
    section where code.code = &apos;11329-0&apos; -&gt;  bundle.entry as e2,  e2.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e2.resource = create(&apos;Observation&apos;) as obs2,  obs2.id = uuid() as uuid2,  e2.fullUrl = append(&apos;https://example/Observation/&apos;, uuid2),  request.url = &apos;Observation&apos;,  dReport.result = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs2.id) then {
      section -&gt;  obs2.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
      section -&gt;  obs2.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
      section -&gt; obs2.status = &apos;final&apos; &quot;STatusobse&quot;;
      section.code -&gt; obs2.code;
      observation.statusCode as s then {
        s.code as cos -&gt; obs2.status = translate(cos, &apos;#OBSstatus&apos;, &apos;code&apos;) &quot;codeS&quot;;
      } &quot;status&quot;;
      section.component as component then {
        component.section as section then {
          section.code where code = &apos;10160-0&apos; then {
            section.entry as entry then {
              entry.substanceAdministration as subAdmin -&gt;  bundle.entry as e11,  e11.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e11.resource = create(&apos;MedicationStatement&apos;) as medicationstatement,  medicationstatement.id = uuid() as uuid11,  e11.fullUrl = append(&apos;https://example/MedicationStatement/&apos;, uuid11),  request.url = &apos;MedicationStatement&apos;,  obs2.partOf = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/MedicationStatement/&apos; + %medicationstatement.id) then MedicationStatement(subAdmin, medicationstatement, patient, encounter, bundle) &quot;creat&quot;;
            };
          } &quot;sectionCode&quot;;
          section.code where code = &apos;48765-2&apos; then {
            section -&gt;  bundle.entry as e4,  e4.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e4.resource = create(&apos;List&apos;) as list1,  list1.id = uuid() as uuid4,  e4.fullUrl = append(&apos;https://example/List/&apos;, uuid4),  request.url = &apos;List&apos;,  obs2.focus = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/List/&apos; + %list1.id) then {
              section -&gt;  list1.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
              section -&gt; list1.status = &apos;current&apos; &quot;listatus&quot;;
              section -&gt; list1.mode = &apos;working&apos; &quot;lstmod&quot;;
              section -&gt;  list1.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
              section -&gt; list1.entry as entryList1 then {
                section.entry as entry then {
                  entry.act as act1 -&gt;  bundle.entry as e5,  e5.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e5.resource = create(&apos;AllergyIntolerance&apos;) as allergy,  allergy.id = uuid() as uuid5,  e5.fullUrl = append(&apos;https://example/AllergyIntolerance/&apos;, uuid5),  request.url = &apos;AllergyIntolerance&apos;,  entryList1.item = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/AllergyIntolerance/&apos; + %allergy.id) then allergyFunction(act1, allergy, patient, encounter) &quot;allergy&quot;;
                } &quot;entryAll&quot;;
              } &quot;entryList&quot;;
            } &quot;section&quot;;
          } &quot;conditionAllergie&quot;;
        };
      } &quot;subSection&quot;;
      section.entry as entry then {
        entry.observation -&gt;  bundle.entry as e3,  e3.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e3.resource = create(&apos;Condition&apos;) as condition,  condition.id = uuid() as uuid3,  e3.fullUrl = append(&apos;https://example/Condition/&apos;, uuid3),  request.url = &apos;Condition&apos;,  obs2.focus = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Condition/&apos; + %condition.id) then ConditionFunction(observation, condition, patient, encounter, bundle) &quot;condition&quot;;
        entry.organizer as organizer then {
          section -&gt;  bundle.entry as e11,  e11.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e11.resource = create(&apos;List&apos;) as list11,  list11.id = uuid() as uuid11,  e11.fullUrl = append(&apos;https://example/List/&apos;, uuid11),  request.url = &apos;List&apos;,  obs2.focus = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/List/&apos; + %list11.id) then {
            section -&gt;  list11.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
            section -&gt; list11.status = &apos;current&apos; &quot;liststat&quot;;
            section -&gt; list11.mode = &apos;working&apos; &quot;listmd&quot;;
            section -&gt;  list11.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
            organizer -&gt; list11.entry as entryList2 then {
              organizer -&gt;  bundle.entry as e12,  e12.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e12.resource = create(&apos;FamilyMemberHistory&apos;) as familyMember,  familyMember.id = uuid() as uuid12,  e12.fullUrl = append(&apos;https://example/FamilyMemberHistory/&apos;, uuid12),  request.url = &apos;FamilyMemberHistory&apos;,  entryList2.item = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/FamilyMemberHistory/&apos; + %familyMember.id) then FamilyMemberFunction(organizer, familyMember, patient) &quot;family&quot;;
            } &quot;org&quot;;
          } &quot;List&quot;;
        };
      };
    } &quot;StoriaClinica1&quot;;
    section where code.code = &apos;30954-2&apos; -&gt;  bundle.entry as e4,  e4.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e4.resource = create(&apos;Observation&apos;) as obs4,  obs4.id = uuid() as uuid4,  e4.fullUrl = append(&apos;https://example/Observation/&apos;, uuid4),  request.url = &apos;Observation&apos;,  dReport.result = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs4.id) then Observation(observation, patient, encounter, obs4, bundle) &quot;PrecedentiEsamiEseguiti&quot;;
    section where code.code = &apos;29548-5&apos; -&gt;  bundle.entry as e5,  e5.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e5.resource = create(&apos;Observation&apos;) as obs5,  obs5.id = uuid() as uuid5,  e5.fullUrl = append(&apos;https://example/Observation/&apos;, uuid5),  request.url = &apos;Observation&apos;,  dReport.result = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs5.id) then Observation(observation, patient, encounter, obs5, bundle) &quot;Diagnosi&quot;;
  } &quot;entryObs&quot;;
  src.act as act then {
    section where code.code = &apos;62387-6&apos; -&gt;  dReport.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) then {
      act.code -&gt; encounter.type &quot;type&quot;;
      act.effectiveTime as effectiveTime -&gt; encounter.period as period then {
        effectiveTime -&gt; period.start = create(&apos;dateTime&apos;) as start then TSDateTime(effectiveTime, start) &quot;val&quot;;
      } &quot;period&quot;;
      act -&gt;  bundle.entry as e10,  e10.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e10.resource = create(&apos;Procedure&apos;) as procedureRes,  procedureRes.id = uuid() as uuid10,  e10.fullUrl = append(&apos;https://example/Procedure/&apos;, uuid10),  request.url = &apos;Procedure&apos;,  encounter.reasonReference = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Procedure/&apos; + %procedureRes.id) then {
        act -&gt;  procedureRes.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
        act -&gt;  procedureRes.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
        act.statusCode -&gt; procedureRes.status &quot;status1&quot;;
        act where statusCode.exists().not() -&gt; procedureRes.status = &apos;unknown&apos; &quot;status2&quot;;
        act.entryRelationship as entryRel then {
          entryRel.procedure as proc -&gt;  bundle.entry as e9,  e9.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e9.resource = create(&apos;Procedure&apos;) as procedure2,  procedure2.id = uuid() as uuid9,  e9.fullUrl = append(&apos;https://example/Procedure/&apos;, uuid9),  request.url = &apos;Procedure&apos;,  procedureRes.partOf = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Procedure/&apos; + %procedure2.id) then Procedure(proc, patient, encounter, procedure2, bundle) &quot;procedurePrestazioni&quot;;
          entryRel.substanceAdministration as subAdmin -&gt;  bundle.entry as e8,  e8.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e8.resource = create(&apos;MedicationAdministration&apos;) as medAdmin,  medAdmin.id = uuid() as uuid8,  e8.fullUrl = append(&apos;https://example/MedicationAdministration/&apos;, uuid8),  request.url = &apos;MedicationAdministration&apos;,  procedureRes.partOf = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/MedicationAdministration/&apos; + %medAdmin.id) then MedicationAdministration(subAdmin, patient, encounter, medAdmin, bundle) &quot;farmacPrestazioni&quot;;
          entryRel.observation as entryRobs -&gt;  bundle.entry as e7,  e7.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e7.resource = create(&apos;Observation&apos;) as obs7,  obs7.id = uuid() as uuid7,  e7.fullUrl = append(&apos;https://example/Observation/&apos;, uuid7),  request.url = &apos;Observation&apos;,  procedureRes.partOf = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs7.id) then ObservationPrest(entryRobs, patient, encounter, obs7, bundle) &quot;osservazioniPrestazioni&quot;;
          entryRel.act as act2 -&gt;  bundle.entry as e6,  e6.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e6.resource = create(&apos;Procedure&apos;) as procedure3,  procedure3.id = uuid() as uuid6,  e6.fullUrl = append(&apos;https://example/Procedure/&apos;, uuid6),  request.url = &apos;Procedure&apos;,  procedureRes.partOf = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Procedure/&apos; + %procedure3.id) then Procedure(act2, patient, encounter, procedure3, bundle) &quot;procedureGenerichePrestazioni&quot;;
        } &quot;Relationship&quot;;
      } &quot;proceduraMadre&quot;;
    } &quot;Prestazioni&quot;;
    section where code.code = &apos;80615-8&apos; -&gt;  bundle.entry as e12,  e12.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e12.resource = create(&apos;Observation&apos;) as obs12,  obs12.id = uuid() as uuid12,  e12.fullUrl = append(&apos;https://example/Observation/&apos;, uuid12),  request.url = &apos;Observation&apos;,  dReport.result = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs12.id) then Observation(act, patient, encounter, obs12, bundle) &quot;Followup&quot;;
  } &quot;entryAct&quot;;
  // src.substanceAdministration
  src.substanceAdministration as substanceadmin then {
    section where code.code = &apos;93341-6&apos; -&gt;  bundle.entry as e6,  e6.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e6.resource = create(&apos;MedicationRequest&apos;) as medre1,  medre1.id = uuid() as uuid6,  e6.fullUrl = append(&apos;https://example/MedicationRequest/&apos;, uuid6),  request.url = &apos;MedicationRequest&apos;,  dReport.basedOn = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/MedicationRequest/&apos; + %medre1.id) then MedicationRequest(substanceadmin, patient, encounter, medre1, bundle) &quot;TerapiaFarmacologicaConsigliata&quot;;
  } &quot;substanceadmin&quot;;
  section where section.entry.exists().not() then {
    section where (code.code = &apos;48765-2&apos;) -&gt;  bundle.entry as e2,  e2.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e2.resource = create(&apos;Observation&apos;) as obs1,  obs1.id = uuid() as uuid2,  e2.fullUrl = append(&apos;https://example/Observation/&apos;, uuid2),  request.url = &apos;Observation&apos;,  dReport.result = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs1.id) then {
      section -&gt;  obs1.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
      section -&gt;  obs1.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
      section -&gt; obs1.status = &apos;final&apos; &quot;STatusobse&quot;;
      section.code -&gt; obs1.code;
      section.statusCode as s then {
        s.code as cos -&gt; obs1.status = translate(cos, &apos;#OBSstatus&apos;, &apos;code&apos;) &quot;codeS&quot;;
      } &quot;status&quot;;
      section.text as text -&gt;  bundle.entry as e5,  e5.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e5.resource = create(&apos;AllergyIntolerance&apos;) as allergy,  allergy.id = uuid() as uuid5,  e5.fullUrl = append(&apos;https://example/AllergyIntolerance/&apos;, uuid5),  request.url = &apos;AllergyIntolerance&apos;,  obs1.focus = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/AllergyIntolerance/&apos; + %allergy.id) then {
        section -&gt;  allergy.patient = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
        section -&gt;  allergy.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
        section -&gt; allergy.clinicalStatus as clinicalStatus then {
          section -&gt; clinicalStatus.coding = create(&apos;Coding&apos;) as coding then {
            section -&gt; coding.code = &apos;active&apos; &quot;code&quot;;
            section -&gt; coding.system = &apos;http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical&apos; &quot;system&quot;;
          } &quot;coding&quot;;
        } &quot;status&quot;;
        text -&gt; allergy.note as note then {
          text as t -&gt; note.text = create(&apos;string&apos;) as textNote then EDstring(t, textNote) &quot;note&quot;;
        } &quot;narrative&quot;;
      } &quot;allergytext&quot;;
    } &quot;allergyAct&quot;;
    section where (code.code = &apos;93341-6&apos;) then {
      section.text as text -&gt;  bundle.entry as e13,  e13.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e13.resource = create(&apos;MedicationRequest&apos;) as obs13,  obs13.id = uuid() as uuid13,  e13.fullUrl = append(&apos;https://example/MedicationRequest/&apos;, uuid13),  request.url = &apos;MedicationRequest&apos;,  dReport.basedOn = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/MedicationRequest/&apos; + %obs13.id) then {
        section -&gt;  obs13.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
        section -&gt;  obs13.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
        section -&gt; obs13.intent = &apos;order&apos; &quot;intent&quot;;
        section where statusCode.exists().not() -&gt; obs13.status = &apos;unknown&apos; &quot;st&quot;;
        text -&gt; obs13.note as note then {
          text as t -&gt; note.text = create(&apos;string&apos;) as textNote then EDstring(t, textNote) &quot;note&quot;;
        } &quot;note&quot;;
        section -&gt; obs13.medication = create(&apos;CodeableConcept&apos;) as code then {
          section -&gt; code.text = &apos;string&apos; &quot;string&quot;;
        } &quot;code&quot;;
      } &quot;txtsec&quot;;
    } &quot;MedicationRequest&quot;;
    section where (code.code = &apos;55110-1&apos;).not() and (code.code = &apos;93341-6&apos;).not() and (code.code = &apos;48765-2&apos;).not() then {
      section.text as text -&gt;  bundle.entry as e13,  e13.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e13.resource = create(&apos;Observation&apos;) as obs13,  obs13.id = uuid() as uuid13,  e13.fullUrl = append(&apos;https://example/Observation/&apos;, uuid13),  request.url = &apos;Observation&apos;,  dReport.result = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs13.id) then {
        section -&gt;  obs13.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
        section -&gt;  obs13.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
        section -&gt; obs13.status = &apos;preliminary&apos; &quot;obsst&quot;;
        section.code -&gt; obs13.code &quot;obscde&quot;;
        section -&gt; obs13.status = &apos;final&apos; &quot;statusS&quot;;
        text -&gt; obs13.note as note then {
          text as t -&gt; note.text = create(&apos;string&apos;) as textNote then EDstring(t, textNote) &quot;note&quot;;
        } &quot;narrative&quot;;
      } &quot;txtsec&quot;;
    } &quot;NonConclusion&quot;;
    section where (code.code = &apos;55110-1&apos;) then {
      section.text as t -&gt; dReport.conclusion = create(&apos;string&apos;) as textConclusion then EDstring(t, textConclusion) &quot;conc&quot;;
    } &quot;conclusion&quot;;
  } &quot;whereCond&quot;;
}

group Observation(source cda : observation, target patient : Patient, target encounter : Encounter, target ob : Observation, target bundle : Bundle) {
  cda -&gt;  ob.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  cda -&gt;  ob.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
  cda.code -&gt; ob.code;
  cda -&gt; ob.status = &apos;final&apos; &quot;Stats&quot;;
  // value datatype
  cda.value : INT as int -&gt; ob.value = (int.value);
  cda.value : ST as st -&gt;  ob.value = create(&apos;string&apos;),  ob.value = (st.dataString);
  cda.value : BL as boolean -&gt; ob.value = (boolean.value) &quot;boolean&quot;;
  cda.value : CE as val then {
    val -&gt; ob.value = create(&apos;CodeableConcept&apos;) as ce then {
      val.originalText as originalText then {
        originalText.reference as reference -&gt; ce.text = (reference.value);
      };
      val -&gt; ce.coding as coding then {
        val.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
        val.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
        val.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
      } &quot;code&quot;;
      val.translation as translation -&gt; ce.coding as coding then {
        translation.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
        translation.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
        translation.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
        translation.qualifier as qualifier then {
          qualifier.value as value -&gt; ce.coding as coding then {
            value.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
            value.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
            value.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
          };
        };
      };
    } &quot;coding&quot;;
  } &quot;val&quot;;
  cda.value : CD as val then {
    val -&gt; ob.value = create(&apos;CodeableConcept&apos;) as ce then {
      val.originalText as originalText then {
        originalText.reference as reference -&gt; ce.text = (reference.value);
      };
      val -&gt; ce.coding as coding then {
        val.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
        val.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
        val.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
      } &quot;code&quot;;
      val.translation as translation -&gt; ce.coding as coding then {
        translation.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
        translation.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
        translation.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
        translation.qualifier as qualifier then {
          qualifier.value as value -&gt; ce.coding as coding then {
            value.code as code -&gt; coding.code = cast(code, &apos;string&apos;);
            value.codeSystem as system -&gt; coding.system = translate(system, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;);
            value.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;);
          };
        };
      };
    } &quot;coding&quot;;
  } &quot;val&quot;;
  cda.value : PQ as val then {
    val -&gt; ob.value = create(&apos;Quantity&apos;) as quantity then {
      val.value as value -&gt; quantity.value = value;
      val.unit as unit -&gt; quantity.unit = unit;
    } &quot;quantity&quot;;
  } &quot;valueQuantity&quot;;
  cda.effectiveTime as effectiveTime where (value.exists()) -&gt; ob.effective = create(&apos;dateTime&apos;) as value then TSDateTime(effectiveTime, value) &quot;value1&quot;;
  cda.effectiveTime as effectiveTime where (low.exists()) -&gt; ob.effective = create(&apos;Period&apos;) as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;
  cda.text as text -&gt; ob.note as note then {
    text.reference as reference -&gt; note.text = (reference.value) &quot;text&quot;;
  } &quot;note&quot;;
  cda.statusCode as s then {
    s.code as cos -&gt; ob.status = translate(cos, &apos;#OBSstatus&apos;, &apos;code&apos;) &quot;codeS&quot;;
  } &quot;status&quot;;
}

group ConditionFunction(source src : cdaElement, target tgt : Condition, target patient : patient, target encounter : encounter, target bundle : Bundle) {
  src.code -&gt; tgt.category;
  src -&gt;  tgt.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  src -&gt;  tgt.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
  src.statusCode as stscode -&gt; tgt.verificationStatus as verifstatus then {
    stscode as codeS -&gt; verifstatus.coding = create(&apos;Coding&apos;) as coding then {
      codeS.code -&gt; coding.code = &apos;confirmed&apos;;
      codeS -&gt; coding.system = &apos;http://terminology.hl7.org/CodeSystem/condition-ver-status&apos; &quot;system&quot;;
      codeS -&gt; coding.display = cast(&apos;Confirmed&apos;, &apos;string&apos;) &quot;display&quot;;
    } &quot;coding&quot;;
  } &quot;verifstatus&quot;;
  src.effectiveTime as effectiveTime -&gt; tgt.onset = create(&apos;Period&apos;) as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;
  src.value -&gt; tgt.code;
  src.entryRelationship as entryRelationship then {
    entryRelationship.observation as obsentry then {
      obsentry.code where code = &apos;89261-2&apos; then {
        obsentry -&gt;  tgt.evidence as evidence,  bundle.entry as e1,  e1.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e1.resource = create(&apos;Observation&apos;) as obsy,  obsy.id = uuid() as uuid1,  e1.fullUrl = append(&apos;https://example/Observation/&apos;, uuid1),  request.url = &apos;Observation&apos;,  evidence.detail = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obsy.id) then Observation(obsentry, patient, encounter, obsy, bundle) &quot;observation&quot;;
      } &quot;observation&quot;;
      obsentry.code where code = &apos;33999-4&apos; then {
        obsentry.value as value -&gt; tgt.clinicalStatus as clinicalstatus then {
          value as val -&gt; clinicalstatus.coding = create(&apos;Coding&apos;) as coding then {
            val where (code = &apos;LA9041-0&apos;) -&gt; coding.code = &apos;resolved&apos; &quot;code&quot;;
            val where (code = &apos;LA18632-2&apos;) -&gt; coding.code = &apos;inactive&apos; &quot;code&quot;;
            val where (code = &apos;LA16666-2&apos;) -&gt; coding.code = &apos;active&apos; &quot;code&quot;;
            val -&gt; coding.system = &apos;http://terminology.hl7.org/CodeSystem/condition-clinical&apos; &quot;system&quot;;
            val.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;) &quot;display&quot;;
          } &quot;coding&quot;;
          obsentry.text as text then {
            text.reference as reference -&gt; clinicalstatus.text = (reference.value) &quot;text&quot;;
          };
        } &quot;clinicalstatus&quot;;
      } &quot;clinicalStatus2&quot;;
    } &quot;EntryRelObsevation&quot;;
  } &quot;entryR&quot;;
}

group Procedure(source src : procedure, target patient : Patient, target encounter : Encounter, target tgt : Procedure, target bundle : Bundle) {
  src -&gt;  tgt.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  src -&gt;  tgt.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
  src.statusCode -&gt; tgt.status &quot;status1&quot;;
  src where statusCode.exists().not() -&gt; tgt.status = &apos;unknown&apos; &quot;status2&quot;;
  src.id -&gt; tgt.identifier;
  src.code -&gt; tgt.code;
  src.effectiveTime as effectiveTime where (value.exists()) -&gt; tgt.performed = create(&apos;dateTime&apos;) as value then TSDateTime(effectiveTime, value) &quot;value1&quot;;
  src.effectiveTime as effectiveTime where (low.exists()) -&gt; tgt.performed = create(&apos;Period&apos;) as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;
  src.methodCode as methodCode -&gt; tgt.extension as ext1 then ITMethodExt(methodCode, ext1);
  src.participant as participant then {
    participant.participantRole as participantRole -&gt; tgt.performer as performer then {
      participantRole.playingDevice as device -&gt;  bundle.entry as e2,  e2.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e2.resource = create(&apos;Device&apos;) as deviceRes,  deviceRes.id = uuid() as uuid2,  e2.fullUrl = append(&apos;https://example/Device/&apos;, uuid2),  request.url = &apos;Device&apos;,  performer.actor = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Device/&apos; + %deviceRes.id) then {
        device.manufacturerModelName as manufacturerModelName then {
          manufacturerModelName.displayName as displayName -&gt; deviceRes.manufacturer = cast(displayName, &apos;string&apos;) &quot;manuf&quot;;
        } &quot;manufacturer&quot;;
        device.code -&gt; deviceRes.type;
      } &quot;device&quot;;
    };
  };
  src.entryRelationship as entryR then {
    entryR.observation as observation -&gt;  bundle.entry as e3,  e3.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e3.resource = create(&apos;Observation&apos;) as obs1,  obs1.id = uuid() as uuid3,  e3.fullUrl = append(&apos;https://example/Observation/&apos;, uuid3),  request.url = &apos;Observation&apos;,  tgt.partOf = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs1.id) then Observation(observation, patient, encounter, obs1, bundle) &quot;Parametri&quot;;
    entryR.act as act then {
      act.text as text -&gt; tgt.note as note then {
        text.reference as reference -&gt; note.text = (reference.value) &quot;text&quot;;
      } &quot;note&quot;;
    };
  } &quot;entryRelProcedure&quot;;
}

group ITMethodExt(source src, target ext) {
  src -&gt; ext.url = &apos;http://hl7.org/fhir/StructureDefinition/procedure-method&apos; &quot;url&quot;;
  src -&gt; ext.value = create(&apos;CodeableConcept&apos;) as value then CECodeableConcept(src, value) &quot;value&quot;;
}

group MedicationAdministration(source src : substanceAdministration, target patient : Patient, target encounter : Encounter, target tgt : MedicationAdministration, target bundle : Bundle) {
  src -&gt;  tgt.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  src -&gt;  tgt.context = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
  src.statusCode -&gt; tgt.status &quot;status1&quot;;
  src where statusCode.exists().not() -&gt; tgt.status = &apos;unknown&apos; &quot;status2&quot;;
  src.id -&gt; tgt.identifier;
  src.effectiveTime as effectiveTime where (value.exists()) -&gt; tgt.effective = create(&apos;dateTime&apos;) as value then TSDateTime(effectiveTime, value) &quot;value1&quot;;
  src.effectiveTime as effectiveTime where (low.exists()) -&gt; tgt.effective = create(&apos;Period&apos;) as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;
  src -&gt; tgt.dosage as dosage then {
    src.routeCode -&gt; dosage.route &quot;route&quot;;
    src.repeatNumber as repeatNumber -&gt; dosage.rate = create(&apos;SimpleQuantity&apos;) as value then PQQuantity(repeatNumber, value) &quot;repQ&quot;;
    src.approachSiteCode -&gt; dosage.site &quot;site&quot;;
    src.targetSiteCode -&gt; dosage.site &quot;site&quot;;
  } &quot;dosage&quot;;
  src.consumable as consumable -&gt;  bundle.entry as e1,  e1.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e1.resource = create(&apos;Medication&apos;) as medication,  medication.id = uuid() as uuid1,  e1.fullUrl = append(&apos;https://example/Medication/&apos;, uuid1),  request.url = &apos;Medication&apos;,  tgt.medication = create(&apos;Reference&apos;) as medref,  medref.reference = (&apos;https://example/Medication/&apos; + %medication.id) then Medication(src, medication, patient, bundle) &quot;medication&quot;;
  src.participant as participant then {
    participant.participantRole as participantRole -&gt; tgt.performer as performer then {
      participantRole.device as device -&gt;  bundle.entry as e2,  e2.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e2.resource = create(&apos;Device&apos;) as deviceRes,  deviceRes.id = uuid() as uuid2,  e2.fullUrl = append(&apos;https://example/Device/&apos;, uuid2),  request.url = &apos;Device&apos;,  performer.actor = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Device/&apos; + %deviceRes.id) then {
        device.ManufacturerModelName as ManufacturerModelName then {
          ManufacturerModelName.code -&gt; deviceRes.manufacturer &quot;manuf&quot;;
        } &quot;manufacturer&quot;;
      };
    };
  };
  src.entryRelationship as entryR then {
    entryR.observation as observation -&gt;  bundle.entry as e3,  e3.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e3.resource = create(&apos;Observation&apos;) as obs1,  obs1.id = uuid() as uuid3,  e3.fullUrl = append(&apos;https://example/Observation/&apos;, uuid3),  request.url = &apos;Observation&apos;,  tgt.partOf = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs1.id) then Observation(observation, patient, encounter, obs1, bundle) &quot;Parametri&quot;;
    entryR.act as act then {
      act.text as text -&gt; tgt.note as note then {
        text.reference as reference -&gt; note.text = (reference.value) &quot;text&quot;;
      } &quot;note&quot;;
    };
  } &quot;entryRelMedication&quot;;
  src where (src.doseQuantity.exists() or src.rateQuantity.exists()) -&gt;  bundle.entry as e1,  e1.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e1.resource = create(&apos;MedicationRequest&apos;) as medicationRq,  medicationRq.id = uuid() as uuid1,  e1.fullUrl = append(&apos;https://example/MedicationRequest/&apos;, uuid1),  request.url = &apos;MedicationRequest&apos;,  tgt.request = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/MedicationRequest/&apos; + %medicationRq.id) then MedicationRequest(src, patient, encounter, medicationRq, bundle) &quot;medRequ&quot;;
  src.text as text -&gt; tgt.note as note then {
    text -&gt; note.text &quot;text&quot;;
  } &quot;note&quot;;
}

group ObservationPrest(source src : observation, target patient : Patient, target encounter : Encounter, target tgt : Observation, target bundle : Bundle) {
  src -&gt;  tgt.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  src -&gt;  tgt.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
  src.statusCode as s then {
    s.code as cos -&gt; tgt.status = translate(cos, &apos;#OBSstatus&apos;, &apos;code&apos;) &quot;codeS&quot;;
  } &quot;status&quot;;
  src.id -&gt; tgt.identifier;
  src.code -&gt; tgt.code;
  src.effectiveTime as effectiveTime where (value.exists()) -&gt; tgt.perfomed = create(&apos;dateTime&apos;) as value then TSDateTime(effectiveTime, value) &quot;value1&quot;;
  src.effectiveTime as effectiveTime where (low.exists()) -&gt; tgt.perfomed = create(&apos;Period&apos;) as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;
  src.methodCode -&gt; tgt.method;
  src.participant as participant then {
    participant.participantRole as participantRole then {
      participantRole.device as device -&gt;  bundle.entry as e2,  e2.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e2.resource = create(&apos;Device&apos;) as deviceRes,  deviceRes.id = uuid() as uuid2,  e2.fullUrl = append(&apos;https://example/Device/&apos;, uuid2),  request.url = &apos;Device&apos;,  tgt.device = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Device/&apos; + %deviceRes.id) then {
        device.ManufacturerModelName as ManufacturerModelName then {
          ManufacturerModelName.code -&gt; deviceRes.manufacturer &quot;manuf&quot;;
        } &quot;manufacturer&quot;;
      };
    };
  };
  src.entryRelationship as entryR then {
    entryR.observation as observation -&gt;  bundle.entry as e3,  e3.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e3.resource = create(&apos;Observation&apos;) as obs1,  obs1.id = uuid() as uuid3,  e3.fullUrl = append(&apos;https://example/Observation/&apos;, uuid3),  request.url = &apos;Observation&apos;,  tgt.hasMember = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Observation/&apos; + %obs1.id) then Observation(observation, patient, encounter, obs1, bundle) &quot;Parametri&quot;;
    entryR.act as act then {
      act.text as text -&gt; tgt.note as note then {
        text.reference as reference -&gt; note.text = (reference.value) &quot;text&quot;;
      } &quot;note&quot;;
    };
  } &quot;entryRelOsservazioni&quot;;
}

group MedicationRequest(source src : substanceAdministration, target patient : Patient, target encounter : Encounter, target tgt : MedicationRequest, target bundle : Bundle) {
  // default  + mandatory
  src -&gt;  tgt.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  src -&gt;  tgt.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
  src -&gt; tgt.intent = &apos;order&apos; &quot;intent&quot;;
  src where statusCode.exists().not() -&gt; tgt.status = &apos;unknown&apos; &quot;st&quot;;
  src.statusCode as sc then {
    sc.code as cos -&gt; tgt.status = translate(cos, &apos;#MedicationStatusMap&apos;, &apos;code&apos;) &quot;codeS&quot;;
  } &quot;status&quot;;
  src.text as txt -&gt; tgt.note as note then {
    txt.reference as reference -&gt; note.text = (reference.value) &quot;text&quot;;
  } &quot;note&quot;;
  src.effectiveTime : IVL_TS as eff -&gt; tgt.dosageInstruction = create(&apos;Dosage&apos;) as dosage then {
    eff -&gt; dosage.timing = create(&apos;Timing&apos;) as timing then {
      eff -&gt; timing.repeat as rep then {
        eff as eff where (value.exists()) -&gt; rep.bounds = create(&apos;dateTime&apos;) as value then TSDateTime(eff, value) &quot;value1&quot;;
        eff as eff where (low.exists()) -&gt; rep.bounds = create(&apos;Period&apos;) as value then IVLTSPeriod(eff, value) &quot;valuePeriod&quot;;
      } &quot;rep&quot;;
    } &quot;timing&quot;;
  } &quot;period&quot;;
  src.effectiveTime : EIVL_TS as effe -&gt; tgt.dosageInstruction = create(&apos;Dosage&apos;) as dosage then {
    effe -&gt; dosage.timing = create(&apos;Timing&apos;) as timing then {
      effe -&gt; timing.repeat as rep then {
        effe.eventCode as ev -&gt; rep.when = (ev.code);
      } &quot;rep&quot;;
    } &quot;timing&quot;;
  } &quot;period&quot;;
  src.effectiveTime : IVL_TS as eff -&gt;  tgt.dosageInstruction = create(&apos;Dosage&apos;) as dosage,  dosage.timing = create(&apos;Timing&apos;) as timing,  timing.event = (eff.value) &quot;tim&quot;;
  src.effectiveTime : PIVL_TS as eff -&gt; tgt.dosageInstruction = create(&apos;Dosage&apos;) as dosage then {
    eff -&gt; dosage.timing = create(&apos;Timing&apos;) as timing then periodTiming(eff, timing) &quot;cod&quot;;
  } &quot;eff&quot;;
  src where (src.doseQuantity.exists() or src.rateQuantity.exists()) then {
    src -&gt; tgt.dosageInstruction = create(&apos;Dosage&apos;) as dosageInstruction then {
      src.doseQuantity as doseQuant then {
        doseQuant.originalText as ot then {
          ot.reference -&gt; dosageInstruction.text;
        } &quot;ot&quot;;
        doseQuant -&gt; dosageInstruction.doseAndRate as dosageRate then {
          doseQuant -&gt; dosageRate.dose = create(&apos;Range&apos;) as d then {
            doseQuant -&gt; d.low = create(&apos;SimpleQuantity&apos;) as l then {
              doseQuant.low as lo -&gt; l.value = (lo.value);
              doseQuant.low as lo -&gt; l.unit = (lo.unit);
            } &quot;low&quot;;
            doseQuant -&gt; d.high = create(&apos;SimpleQuantity&apos;) as h then {
              doseQuant.high as hi -&gt; h.value = (hi.value);
              doseQuant.high as hi -&gt; h.unit = (hi.unit);
            } &quot;low&quot;;
          } &quot;d&quot;;
        } &quot;dosageRate&quot;;
      };
      src.rateQuantity as rateQuantity then {
        rateQuantity.originalText as ot then {
          ot.reference -&gt; dosageInstruction.text;
        } &quot;ot&quot;;
        rateQuantity -&gt; dosageInstruction.doseAndRate as dosageRate then {
          rateQuantity -&gt; dosageRate.rate = create(&apos;Range&apos;) as d then {
            rateQuantity -&gt; d.low = create(&apos;SimpleQuantity&apos;) as l then {
              rateQuantity.low as lo -&gt; l.value = (lo.value);
              rateQuantity.low as lo -&gt; l.unit = (lo.unit);
            } &quot;low&quot;;
            rateQuantity -&gt; d.high = create(&apos;SimpleQuantity&apos;) as h then {
              rateQuantity.high as hi -&gt; h.value = (hi.value);
              rateQuantity.high as hi -&gt; h.unit = (hi.unit);
            } &quot;high&quot;;
          } &quot;r&quot;;
        } &quot;dosageRate&quot;;
      } &quot;rate&quot;;
      src.routeCode -&gt; dosageInstruction.route &quot;route&quot;;
      src.approachSiteCode -&gt; dosageInstruction.site &quot;site&quot;;
      src.targetSiteCode -&gt; dosageInstruction.site &quot;site&quot;;
    } &quot;dosageIn&quot;;
  } &quot;condition&quot;;
  src.consumable as consumable -&gt;  bundle.entry as e1,  e1.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;POST&apos;,  e1.resource = create(&apos;Medication&apos;) as medication,  medication.id = uuid() as uuid1,  e1.fullUrl = append(&apos;https://example/Medication/&apos;, uuid1),  request.url = &apos;Medication&apos;,  tgt.medication = create(&apos;Reference&apos;) as medref,  medref.reference = (&apos;https://example/Medication/&apos; + %medication.id) then Medication(src, medication, patient, bundle) &quot;medication&quot;;
  src.entryRelationship as entryRelationship then {
    entryRelationship.supply as supply -&gt; tgt.dispenseRequest as dispenseRequest then {
      supply.quantity as quantityCDA -&gt; dispenseRequest.quantity as quantityFHIR then {
        quantityCDA -&gt; quantityFHIR.value = (quantityCDA.value) &quot;value&quot;;
      };
    };
  } &quot;entryR&quot;;
  src.participant as participant then {
    participant then Practitioner(participant, tgt, bundle) &quot;function&quot;;
    participant.effectiveTime -&gt; tgt.authoredOn &quot;autor&quot;;
  } &quot;Partecipant&quot;;
}

group periodTiming(source effectiveTime : PIVL_TS, target timing : Timing) {
  effectiveTime -&gt; timing.repeat as r then {
    effectiveTime.period as p -&gt; r.period = (p.value);
    effectiveTime.period as p -&gt; r.periodUnit = (p.unit);
  } &quot;repeat&quot;;
}

group Medication(source src : cda, target tgt : Medication, target patient : Patient, target bundle : Bundle) {
  src.consumable as consumable then {
    consumable.manufacturedProduct as manufacturedProduct then {
      manufacturedProduct.manufacturedMaterial as manufacturedMaterial then {
        manufacturedMaterial.code -&gt; tgt.code &quot;CE&quot;;
        src.administrationUnitCode -&gt; tgt.form &quot;form&quot;;
      } &quot;material&quot;;
    } &quot;product&quot;;
  };
  src.entryRelationship as entryR then {
    entryR.observation as observation then {
      observation.code where displayName = &apos;Grammatura&apos; -&gt; tgt.ingredient as ingredient then {
        src.consumable as consumable then {
          consumable.manufacturedProduct as manufacturedProduct then {
            manufacturedProduct.manufacturedMaterial as manufacturedMaterial then {
              manufacturedMaterial.code as code -&gt; ingredient.item = create(&apos;CodeableConcept&apos;) as value then CECodeableConcept(code, value) &quot;CE&quot;;
            } &quot;material&quot;;
          } &quot;product&quot;;
        };
        observation.value as value -&gt; ingredient.strength as strength then {
          value -&gt; strength.numerator as numerator then {
            value -&gt; numerator.value = (value.value) &quot;valueN&quot;;
          } &quot;numerator&quot;;
          value -&gt; strength.denominator as denominator then {
            value -&gt; denominator.value = 1 &quot;valueD&quot;;
          } &quot;denominator&quot;;
        } &quot;strenght&quot;;
      } &quot;ingredient&quot;;
      observation.code where displayName = &apos;Quantit nella Confezione&apos; then {
        observation.value as value -&gt; tgt.amount as amount then {
          value -&gt; amount.numerator as numerator then {
            value -&gt; numerator.value = (value.value) &quot;valueN&quot;;
          } &quot;numerator&quot;;
          value -&gt; amount.denominator as denominator then {
            value -&gt; denominator.value = 1 &quot;valueD&quot;;
          } &quot;denominator&quot;;
        } &quot;amount&quot;;
      } &quot;quantita&quot;;
    } &quot;obs&quot;;
  } &quot;entryR&quot;;
}

group MedicationStatement(source src : subAdmin, target tgt : MedicationStatement, target patient : Patient, target encounter : Encounter, target bundle : Bundle) {
  src -&gt;  tgt.subject = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  src.statusCode -&gt; tgt.status;
  src where statusCode.exists().not() -&gt; tgt.status = &apos;unknown&apos; &quot;notpresent&quot;;
  src.consumable as consumable then {
    consumable.manufacturedProduct as manufacturedProduct then {
      manufacturedProduct.manufacturedMaterial as manufacturedMaterial then {
        manufacturedMaterial.code as code -&gt; tgt.medication = create(&apos;CodeableConcept&apos;) as ce then CECodeableConcept(code, ce) &quot;CE&quot;;
      } &quot;material&quot;;
    } &quot;product&quot;;
  };
}

group FamilyMemberFunction(source src : organizer, target tgt : FamilyMemberHistory, target patient : patient) {
  src -&gt;  tgt.patient = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;patReference&quot;;
  src.statusCode -&gt; tgt.status;
  src.effectiveTime as effectiveTime -&gt; tgt.date = create(&apos;date&apos;) as value then TSDateTime(effectiveTime, value) &quot;date&quot;;
  src.subject as subject then {
    subject.relatedSubject as relatedSubject then {
      relatedSubject.code -&gt; tgt.relationship &quot;relationshipCode&quot;;
      relatedSubject.subject as subject -&gt; tgt.sex as sex then {
        subject.administrativeGenderCode as administrativeGenderCode -&gt; sex.coding as coding then {
          administrativeGenderCode.code as sexCode -&gt; coding.code = translate(sexCode, &apos;#cm-v3-administrative-gender&apos;, &apos;code&apos;) &quot;gender&quot;;
          administrativeGenderCode -&gt; coding.system = &apos;http://hl7.org/fhir/administrative-gender&apos; &quot;system&quot;;
        } &quot;coding&quot;;
      };
    } &quot;relatedSub&quot;;
  } &quot;relationship&quot;;
  src.component as component -&gt; tgt.condition as condition then {
    component.observation as observation then {
      observation.code -&gt; condition.code;
      observation.text as text -&gt; tgt.note as note then {
        text.reference as reference -&gt; note.text = (reference.value) &quot;value&quot;;
      } &quot;reference&quot;;
      observation.statusCode -&gt; tgt.status;
      // observation.effectiveTime as effectiveTime -&gt; condition.onset = create(&apos;Period&apos;) as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;
      observation where observation.effectiveTime.exists() then {
        observation.effectiveTime as effectiveTime -&gt; tgt.condition = create(&apos;BackboneElement&apos;) as condition then {
          observation.code -&gt; condition.code;
          observation.value -&gt; condition.outcome &quot;codeable&quot;;
          effectiveTime -&gt; condition.onset = create(&apos;Period&apos;) as period then {
            effectiveTime -&gt; period.start = create(&apos;dateTime&apos;) as start then TSDateTime(effectiveTime, start) &quot;val&quot;;
          } &quot;efft&quot;;
        } &quot;effttemp&quot;;
      } &quot;cont&quot;;
      observation.value -&gt; condition.outcome &quot;codeable&quot;;
      observation.entryRelationship as entryR then {
        entryR.observation as obs then {
          obs where (code.code = &apos;35267-4&apos;) then {
            obs.value as value -&gt; condition.onset = create(&apos;Age&apos;) as Age then {
              value.value as valueAge -&gt; Age.value = valueAge &quot;age&quot;;
              value.unit as unit -&gt; Age.code = unit;
              value.unit as unit -&gt; Age.unit = unit;
              value -&gt; Age.system = &apos;http://unitsofmeasure.org&apos; &quot;system&quot;;
            };
          } &quot;insorgenza&quot;;
          obs where (code.code = &apos;39016-1&apos;) then {
            obs.value as value -&gt; tgt.deceased = create(&apos;Age&apos;) as Age then {
              value.value as valueAge -&gt; Age.value = valueAge &quot;age&quot;;
              value.unit as unit -&gt; Age.code = unit;
              value.unit as unit -&gt; Age.unit = unit;
              value -&gt; Age.system = &apos;http://unitsofmeasure.org&apos; &quot;system&quot;;
            };
          } &quot;death&quot;;
        } &quot;obser&quot;;
      } &quot;EntryRel&quot;;
    };
  };
}

group allergyFunction(source src : cdaElement, target tgt : AllergyIntolerance, target patient : patient, target encounter : encounter) {
  src -&gt;  tgt.patient = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Patient/&apos; + %patient.id) &quot;reference&quot;;
  src -&gt;  tgt.encounter = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Encounter/&apos; + %encounter.id) &quot;reference&quot;;
  src.entryRelationship as entryRelationship1 then {
    entryRelationship1.observation as observation1 then {
      observation1.effectiveTime as effectiveTime -&gt; tgt.onset = create(&apos;Period&apos;) as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;
      observation1.value as code then {
        code.code as code1 -&gt; tgt.type = translate(code1, &apos;#AllergyTypeMap&apos;, &apos;code&apos;) &quot;type&quot;;
        code.code as code1 -&gt; tgt.category = translate(code1, &apos;#AllergyCategoryMap&apos;, &apos;code&apos;) &quot;category&quot;;
      } &quot;code&quot;;
      observation1.participant as participant -&gt; tgt.reaction as reaction then {
        observation1.entryRelationship as entryRelationship2 where (typeCode = &apos;MFST&apos;) then {
          entryRelationship2.observation as observation2 then {
            observation2.value -&gt; reaction.manifestation &quot;manifestation&quot;;
            observation2.effectiveTime as effectiveTime then {
              effectiveTime.low as low -&gt; reaction.onset = create(&apos;dateTime&apos;) as value then TSDateTime(low, value) &quot;valuePeriodLow&quot;;
            } &quot;low&quot;;
          } &quot;observ2&quot;;
        } &quot;entryR2&quot;;
        participant.participantRole as participantRole then {
          participantRole.playingEntity as playingEntity then {
            playingEntity.code -&gt; reaction.substance &quot;reaction&quot;;
          };
        };
      };
      observation1.entryRelationship as entryRelationship2 where (typeCode = &apos;MFST&apos;) then {
        entryRelationship2.observation as observation2 where observation1.participant.exists().not() -&gt; tgt.reaction as reaction then {
          observation2.value -&gt; reaction.manifestation &quot;manifestation&quot;;
          observation2.effectiveTime as effectiveTime then {
            effectiveTime.low as low -&gt; reaction.onset = create(&apos;dateTime&apos;) as value then TSDateTime(low, value) &quot;valuePeriodLow&quot;;
          } &quot;low&quot;;
        } &quot;observ2&quot;;
      } &quot;entryR2&quot;;
      observation1.entryRelationship as entryRelationship3 where (typeCode = &apos;SUBJ&apos;) then {
        entryRelationship3.observation as observation3 then {
          observation3.value as value then {
            value.code as c -&gt; tgt.criticality = translate(c, &apos;#CricalityMap&apos;, &apos;code&apos;) &quot;value&quot;;
          } &quot;criticality&quot;;
        } &quot;observ3&quot;;
        entryRelationship3.act as act -&gt; tgt.note as note then {
          act.text as text then {
            text.reference as reference -&gt; note.text = (reference.value);
          } &quot;note&quot;;
        };
      } &quot;entryR3&quot;;
      observation1.entryRelationship as entryRelationship4 where (typeCode = &apos;REFR&apos;) then {
        entryRelationship4.observation as observation4 then {
          observation4.value as value -&gt; tgt.clinicalStatus as clinicalStatus then {
            value as valu -&gt; clinicalStatus.coding = create(&apos;Coding&apos;) as coding then {
              valu where (code = &apos;LA9041-0&apos;) -&gt; coding.code = &apos;resolved&apos; &quot;code&quot;;
              valu where (code = &apos;LA18632-2&apos;) -&gt; coding.code = &apos;inactive&apos; &quot;code&quot;;
              valu where (code = &apos;LA16666-2&apos;) -&gt; coding.code = &apos;active&apos; &quot;code&quot;;
              valu -&gt; coding.system = &apos;http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical&apos; &quot;system&quot;;
              valu.displayName as display -&gt; coding.display = cast(display, &apos;string&apos;) &quot;display&quot;;
            } &quot;coding&quot;;
          } &quot;clinicalStatus&quot;;
        } &quot;observ4&quot;;
      } &quot;entryR4&quot;;
    };
  } &quot;entryrelationship&quot;;
}

group Practitioner(source src : participant, target tgt : MedicationRequest, target bundle : Bundle) {
  src -&gt;  bundle.entry as e22,  e22.request = create(&apos;BackboneElement&apos;) as request,  request.method = &apos;PUT&apos;,  e22.resource = create(&apos;Practitioner&apos;) as practitioner1 then {
    src.participantRole as practr then {
      practr.id as id -&gt; practitioner1.identifier as identifier then {
        id.root as r -&gt; identifier.system = translate(r, &apos;http://hl7.org/fhir/ConceptMap/special-oid2uri&apos;, &apos;uri&apos;) &quot;root1&quot;;
        id.extension as ext -&gt; identifier.value = ext &quot;ext&quot;;
        id.assigningAuthorityName as s -&gt;  identifier.assigner as a,  a.display = s;
        id.root as r then {
          id.extension as ext -&gt;  practitioner1.id = (r + &apos;-&apos; + ext) as uuid22,  e22.fullUrl = append(&apos;https://example/Practitioner/&apos;, uuid22),  tgt.requester = create(&apos;Reference&apos;) as reference,  reference.reference = (&apos;https://example/Practitioner/&apos; + %practitioner1.id) &quot;id&quot;;
        } &quot;r&quot;;
      } &quot;identifier&quot;;
      practr.id as id where (root = &apos;2.16.840.1.113883.2.9.4.3.2&apos;) then {
        id.extension as ext -&gt; request.url = append(&apos;Practitioner?identifier=&apos;, ext) &quot;UUID&quot;;
      } &quot;2&quot;;
      practr.id as id where (root != &apos;2.16.840.1.113883.2.9.4.3.2&apos;) then {
        id.extension as ext -&gt; request.url = append(&apos;Practitioner?identifier=&apos;, ext) &quot;UUID&quot;;
      } &quot;diverso&quot;;
      practr -&gt; practitioner1.meta as meta then {
        practr -&gt; meta.tag = create(&apos;Coding&apos;) as coding then {
          practr -&gt; coding.system = &apos;http://algoritmodiscoring&apos; &quot;system&quot;;
          practr -&gt; coding.code = &apos;ClinicalDocument/body/TerapiaFarmacologicaConsigliata/participant&apos; &quot;code&quot;;
        } &quot;coding&quot;;
      } &quot;meta&quot;;
      practr.addr -&gt; practitioner1.address;
      practr.telecom -&gt; practitioner1.telecom;
      practr.playingEntity as plentity then {
        plentity.name -&gt; practitioner1.name;
        plentity.birthTime as birthTime then {
          birthTime.value as date -&gt; practitioner1.birthDate = truncate(date, 10);
        } &quot;birth&quot;;
      } &quot;partname&quot;;
    } &quot;resurceCreation&quot;;
  } &quot;practitionerCreate&quot;;
}

</pre>
      </div>
   </text>
   <url value="http://hl7.it/fhir/cda2fhir/StructureMap/cda2fhirAmbReport"/>
   <name value="cda2fhirAmbReport"/>
   <status value="draft"/>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument"/>
      <mode value="source"/>
      <alias value="ClinicalDocument"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor"/>
      <mode value="queried"/>
      <alias value="AssignedAuthor"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity"/>
      <mode value="queried"/>
      <alias value="AssignedEntity"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssociatedEntity"/>
      <mode value="queried"/>
      <alias value="AssociatedEntity"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization"/>
      <mode value="queried"/>
      <alias value="CustodianOrganization"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/OrganizationPartOf"/>
      <mode value="queried"/>
      <alias value="OrganizationPartOf"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Organization"/>
      <mode value="queried"/>
      <alias value="rapresentedOrganization"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Section"/>
      <mode value="queried"/>
      <alias value="Section"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/PatientRole"/>
      <mode value="queried"/>
      <alias value="PatientRole"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AD"/>
      <mode value="source"/>
      <alias value="AD"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
      <mode value="target"/>
      <alias value="Bundle"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Composition"/>
      <mode value="produced"/>
      <alias value="Composition"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Patient"/>
      <mode value="produced"/>
      <alias value="Patient"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Encounter"/>
      <mode value="produced"/>
      <alias value="Encounter"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Person"/>
      <mode value="produced"/>
      <alias value="Patient"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/List"/>
      <mode value="produced"/>
      <alias value="List"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Practitioner"/>
      <mode value="produced"/>
      <alias value="Practitioner"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Organization"/>
      <mode value="produced"/>
      <alias value="Organization"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Act"/>
      <mode value="produced"/>
      <alias value="Act"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/IVL-PQ"/>
      <mode value="source"/>
      <alias value="IVL_PQ"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/PQ"/>
      <mode value="source"/>
      <alias value="PQ"/>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/SimpleQuantity"/>
      <mode value="target"/>
      <alias value="SimpleQuantity"/>
   </structure>
   <import value="http://hl7.it/fhir/cda2fhir/StructureMap/cda2fhirDataTypes"/>
   <import value="http://hl7.it/fhir/cda2fhir/StructureMap/cda2fhirHeader"/>
   <group>
      <name value="CdaToBundle"/>
      <typeMode value="none"/>
      <input>
         <name value="cda"/>
         <type value="ClinicalDocument"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="ClinicalDocumentToBody"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e"/>
         </target>
         <target>
            <context value="e"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="POST"/>
            </parameter>
         </target>
         <target>
            <context value="e"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="composition"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Composition"/>
            </parameter>
         </target>
         <target>
            <context value="composition"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid1"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/Composition/"/>
            </parameter>
            <parameter>
               <valueId value="uuid1"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="Composition"/>
            </parameter>
         </target>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e2"/>
         </target>
         <target>
            <context value="e2"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="requestPAT"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="requestPAT"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="PUT"/>
            </parameter>
         </target>
         <target>
            <context value="e2"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="patient"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Patient"/>
            </parameter>
         </target>
         <target>
            <context value="patient"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid2"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e2"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/Patient/"/>
            </parameter>
            <parameter>
               <valueId value="uuid2"/>
            </parameter>
         </target>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e3"/>
         </target>
         <target>
            <context value="e3"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="POST"/>
            </parameter>
         </target>
         <target>
            <context value="e3"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="encounter"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Encounter"/>
            </parameter>
         </target>
         <target>
            <context value="encounter"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid3"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e3"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/Encounter/"/>
            </parameter>
            <parameter>
               <valueId value="uuid3"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="Encounter"/>
            </parameter>
         </target>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e4"/>
         </target>
         <target>
            <context value="e4"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="POST"/>
            </parameter>
         </target>
         <target>
            <context value="e4"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="DocumentReference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="DocumentReference"/>
            </parameter>
         </target>
         <target>
            <context value="DocumentReference"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid4"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e4"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/DocumentReference/"/>
            </parameter>
            <parameter>
               <valueId value="uuid4"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="DocumentReference"/>
            </parameter>
         </target>
         <rule>
            <name value="cdatobundle"/>
            <source>
               <context value="cda"/>
            </source>
            <dependent>
               <name value="ClinicalDocumentToBundle"/>
               <variable value="cda">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="composition">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="DocumentReference">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="patient"/>
            <source>
               <context value="cda"/>
               <element value="recordTarget"/>
               <variable value="recordTarget"/>
            </source>
            <rule>
               <name value="recPat"/>
               <source>
                  <context value="recordTarget"/>
                  <element value="patientRole"/>
                  <variable value="patient"/>
               </source>
               <rule>
                  <name value="idfr"/>
                  <source>
                     <context value="patient"/>
                     <element value="id"/>
                     <variable value="id"/>
                  </source>
                  <target>
                     <context value="patient"/>
                     <contextType value="variable"/>
                     <element value="identifier"/>
                     <variable value="identifier"/>
                  </target>
                  <rule>
                     <name value="root1"/>
                     <source>
                        <context value="id"/>
                        <element value="root"/>
                        <variable value="r"/>
                     </source>
                     <target>
                        <context value="identifier"/>
                        <contextType value="variable"/>
                        <element value="system"/>
                        <transform value="translate"/>
                        <parameter>
                           <valueId value="r"/>
                        </parameter>
                        <parameter>
                           <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                        </parameter>
                        <parameter>
                           <valueString value="uri"/>
                        </parameter>
                     </target>
                  </rule>
                  <rule>
                     <name value="value"/>
                     <source>
                        <context value="id"/>
                        <element value="extension"/>
                        <variable value="ext1"/>
                     </source>
                     <target>
                        <context value="identifier"/>
                        <contextType value="variable"/>
                        <element value="value"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueId value="ext1"/>
                        </parameter>
                     </target>
                  </rule>
                  <rule>
                     <name value="assigningAuthorityName"/>
                     <source>
                        <context value="id"/>
                        <element value="assigningAuthorityName"/>
                        <variable value="s"/>
                     </source>
                     <target>
                        <context value="identifier"/>
                        <contextType value="variable"/>
                        <element value="assigner"/>
                        <variable value="a"/>
                     </target>
                     <target>
                        <context value="a"/>
                        <contextType value="variable"/>
                        <element value="display"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueId value="s"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="record"/>
                  <source>
                     <context value="patient"/>
                     <element value="id"/>
                     <variable value="id"/>
                     <condition value="(root = '2.16.840.1.113883.2.9.4.3.2') or (root = '2.16.840.1.113883.2.9.4.3.7') or (root = '2.16.840.1.113883.2.9.4.3.3') or (root = '2.16.840.1.113883.2.9.4.3.17') or (root = '2.16.840.1.113883.2.9.4.3.15')"/>
                  </source>
                  <rule>
                     <name value="UUID"/>
                     <source>
                        <context value="id"/>
                        <element value="extension"/>
                        <variable value="ext"/>
                     </source>
                     <target>
                        <context value="requestPAT"/>
                        <contextType value="variable"/>
                        <element value="url"/>
                        <transform value="append"/>
                        <parameter>
                           <valueString value="Patient?identifier="/>
                        </parameter>
                        <parameter>
                           <valueId value="ext"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ClinicalDocumentToBundle"/>
      <typeMode value="none"/>
      <input>
         <name value="cda"/>
         <type value="ClinicalDocument"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="composition"/>
         <type value="Composition"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="DocumentReference"/>
         <type value="DocumentReference"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="id"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="id"/>
            <transform value="uuid"/>
         </target>
      </rule>
      <rule>
         <name value="identifier"/>
         <source>
            <context value="cda"/>
            <element value="id"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="identifier"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="type"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="type"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="transaction"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="date"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="timestamp"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="timestamp.now()"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="composition"/>
         <source>
            <context value="cda"/>
         </source>
         <dependent>
            <name value="ClinicalDocumentComposition"/>
            <variable value="cda">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="composition">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="patient">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="encounter">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="bundle">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="DocumentReference">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="diagnostic"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e"/>
         </target>
         <target>
            <context value="e"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="POST"/>
            </parameter>
         </target>
         <target>
            <context value="e"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="diagnosticReport"/>
            <transform value="create"/>
            <parameter>
               <valueString value="DiagnosticReport"/>
            </parameter>
         </target>
         <target>
            <context value="diagnosticReport"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid1"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/DiagnosticReport/"/>
            </parameter>
            <parameter>
               <valueId value="uuid1"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="DiagnosticReport"/>
            </parameter>
         </target>
         <rule>
            <name value="diagnosticCode"/>
            <source>
               <context value="cda"/>
               <element value="code"/>
               <variable value="vvv"/>
            </source>
            <target>
               <context value="diagnosticReport"/>
               <contextType value="variable"/>
               <element value="code"/>
               <variable value="vvv"/>
               <transform value="create"/>
            </target>
         </rule>
         <rule>
            <name value="stats"/>
            <source>
               <context value="cda"/>
            </source>
            <target>
               <context value="diagnosticReport"/>
               <contextType value="variable"/>
               <element value="status"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="registered"/>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="component"/>
            <source>
               <context value="cda"/>
               <element value="component"/>
               <variable value="component"/>
            </source>
            <rule>
               <name value="body"/>
               <source>
                  <context value="component"/>
                  <element value="structuredBody"/>
                  <variable value="body"/>
               </source>
               <rule>
                  <name value="component"/>
                  <source>
                     <context value="body"/>
                     <element value="component"/>
                     <variable value="component"/>
                  </source>
                  <rule>
                     <name value="section"/>
                     <source>
                        <context value="component"/>
                        <element value="section"/>
                        <variable value="srcSection"/>
                     </source>
                     <rule>
                        <name value="code"/>
                        <source>
                           <context value="srcSection"/>
                           <element value="code"/>
                        </source>
                        <target>
                           <context value="composition"/>
                           <contextType value="variable"/>
                           <element value="section"/>
                           <variable value="tgtSection"/>
                        </target>
                        <dependent>
                           <name value="ClinicalDocumentSection"/>
                           <variable value="cda">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="srcSection">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="patient">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="tgtSection">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="bundle">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="encounter">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="diagnosticReport">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                        </dependent>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ClinicalDocumentSection"/>
      <typeMode value="none"/>
      <input>
         <name value="cda"/>
         <type value="ClinicalDocument"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="src"/>
         <type value="Section"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="tgt"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="enc"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="dReport"/>
         <type value="DiagnosticReport"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="title"/>
         <source>
            <context value="src"/>
            <element value="title"/>
            <variable value="t"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="title"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="t.dataString"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="code"/>
         <source>
            <context value="src"/>
            <element value="code"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="code"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/DiagnosticReport/' + %dReport.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="entry"/>
         <source>
            <context value="src"/>
            <element value="entry"/>
            <variable value="entry"/>
         </source>
         <rule>
            <name value="cdaText"/>
            <source>
               <context value="src"/>
               <element value="text"/>
               <variable value="cdaText"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="text"/>
               <variable value="fhirText"/>
            </target>
            <rule>
               <name value="narrativeStatus"/>
               <source>
                  <context value="cdaText"/>
               </source>
               <target>
                  <context value="fhirText"/>
                  <contextType value="variable"/>
                  <element value="status"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="generated"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="narrativeText"/>
               <source>
                  <context value="cdaText"/>
                  <variable value="t"/>
               </source>
               <target>
                  <context value="fhirText"/>
                  <contextType value="variable"/>
                  <element value="div"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueId value="t"/>
                  </parameter>
               </target>
            </rule>
         </rule>
         <rule>
            <name value="dreport"/>
            <source>
               <context value="entry"/>
            </source>
            <dependent>
               <name value="DiagnosticReportFunction"/>
               <variable value="src">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="entry">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="dReport">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="enc">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="narrative"/>
         <source>
            <context value="src"/>
            <condition value="src.entry.exists().not()"/>
         </source>
         <dependent>
            <name value="DiagnosticReportFunction"/>
            <variable value="src">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="cda">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="dReport">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="bundle">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="enc">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="patient">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="component"/>
         <source>
            <context value="src"/>
            <element value="component"/>
            <variable value="component"/>
         </source>
         <rule>
            <name value="section"/>
            <source>
               <context value="component"/>
               <element value="section"/>
               <variable value="sec"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="section"/>
               <variable value="tgtSection"/>
            </target>
            <dependent>
               <name value="ClinicalDocumentSection"/>
               <variable value="cda">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="sec">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="tgtSection">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="enc">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="dReport">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DiagnosticReportFunction"/>
      <typeMode value="none"/>
      <input>
         <name value="section"/>
         <type value="section"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="src"/>
         <type value="entry"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="dReport"/>
         <type value="DiagnosticReport"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="entryObs"/>
         <source>
            <context value="src"/>
            <element value="observation"/>
            <variable value="observation"/>
         </source>
         <rule>
            <name value="QuesitoDiagnostico"/>
            <source>
               <context value="section"/>
               <condition value="code.code = '29299-5'"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e1"/>
            </target>
            <target>
               <context value="e1"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e1"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs1"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs1"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid1"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e1"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid1"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="result"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs1.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="Observation"/>
               <variable value="observation">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="obs1">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="StoriaClinica1"/>
            <source>
               <context value="section"/>
               <condition value="code.code = '11329-0'"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e2"/>
            </target>
            <target>
               <context value="e2"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e2"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs2"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs2"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid2"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e2"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid2"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="result"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs2.id"/>
               </parameter>
            </target>
            <rule>
               <name value="reference"/>
               <source>
                  <context value="section"/>
               </source>
               <target>
                  <context value="obs2"/>
                  <contextType value="variable"/>
                  <element value="subject"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Patient/' + %patient.id"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="reference"/>
               <source>
                  <context value="section"/>
               </source>
               <target>
                  <context value="obs2"/>
                  <contextType value="variable"/>
                  <element value="encounter"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Encounter/' + %encounter.id"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="STatusobse"/>
               <source>
                  <context value="section"/>
               </source>
               <target>
                  <context value="obs2"/>
                  <contextType value="variable"/>
                  <element value="status"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="final"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"/>
               <source>
                  <context value="section"/>
                  <element value="code"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="obs2"/>
                  <contextType value="variable"/>
                  <element value="code"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="status"/>
               <source>
                  <context value="observation"/>
                  <element value="statusCode"/>
                  <variable value="s"/>
               </source>
               <rule>
                  <name value="codeS"/>
                  <source>
                     <context value="s"/>
                     <element value="code"/>
                     <variable value="cos"/>
                  </source>
                  <target>
                     <context value="obs2"/>
                     <contextType value="variable"/>
                     <element value="status"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="cos"/>
                     </parameter>
                     <parameter>
                        <valueString value="#OBSstatus"/>
                     </parameter>
                     <parameter>
                        <valueString value="code"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="subSection"/>
               <source>
                  <context value="section"/>
                  <element value="component"/>
                  <variable value="component"/>
               </source>
               <rule>
                  <name value="section"/>
                  <source>
                     <context value="component"/>
                     <element value="section"/>
                     <variable value="section"/>
                  </source>
                  <rule>
                     <name value="sectionCode"/>
                     <source>
                        <context value="section"/>
                        <element value="code"/>
                        <condition value="code = '10160-0'"/>
                     </source>
                     <rule>
                        <name value="entry"/>
                        <source>
                           <context value="section"/>
                           <element value="entry"/>
                           <variable value="entry"/>
                        </source>
                        <rule>
                           <name value="creat"/>
                           <source>
                              <context value="entry"/>
                              <element value="substanceAdministration"/>
                              <variable value="subAdmin"/>
                           </source>
                           <target>
                              <context value="bundle"/>
                              <contextType value="variable"/>
                              <element value="entry"/>
                              <variable value="e11"/>
                           </target>
                           <target>
                              <context value="e11"/>
                              <contextType value="variable"/>
                              <element value="request"/>
                              <variable value="request"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="BackboneElement"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="request"/>
                              <contextType value="variable"/>
                              <element value="method"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="POST"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="e11"/>
                              <contextType value="variable"/>
                              <element value="resource"/>
                              <variable value="medicationstatement"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="MedicationStatement"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="medicationstatement"/>
                              <contextType value="variable"/>
                              <element value="id"/>
                              <variable value="uuid11"/>
                              <transform value="uuid"/>
                           </target>
                           <target>
                              <context value="e11"/>
                              <contextType value="variable"/>
                              <element value="fullUrl"/>
                              <transform value="append"/>
                              <parameter>
                                 <valueString value="https://example/MedicationStatement/"/>
                              </parameter>
                              <parameter>
                                 <valueId value="uuid11"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="request"/>
                              <contextType value="variable"/>
                              <element value="url"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="MedicationStatement"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="obs2"/>
                              <contextType value="variable"/>
                              <element value="partOf"/>
                              <variable value="reference"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="Reference"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="reference"/>
                              <contextType value="variable"/>
                              <element value="reference"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="'https://example/MedicationStatement/' + %medicationstatement.id"/>
                              </parameter>
                           </target>
                           <dependent>
                              <name value="MedicationStatement"/>
                              <variable value="subAdmin">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="medicationstatement">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="patient">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="encounter">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="bundle">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                           </dependent>
                        </rule>
                     </rule>
                  </rule>
                  <rule>
                     <name value="conditionAllergie"/>
                     <source>
                        <context value="section"/>
                        <element value="code"/>
                        <condition value="code = '48765-2'"/>
                     </source>
                     <rule>
                        <name value="section"/>
                        <source>
                           <context value="section"/>
                        </source>
                        <target>
                           <context value="bundle"/>
                           <contextType value="variable"/>
                           <element value="entry"/>
                           <variable value="e4"/>
                        </target>
                        <target>
                           <context value="e4"/>
                           <contextType value="variable"/>
                           <element value="request"/>
                           <variable value="request"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="BackboneElement"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="request"/>
                           <contextType value="variable"/>
                           <element value="method"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="POST"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="e4"/>
                           <contextType value="variable"/>
                           <element value="resource"/>
                           <variable value="list1"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="List"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="list1"/>
                           <contextType value="variable"/>
                           <element value="id"/>
                           <variable value="uuid4"/>
                           <transform value="uuid"/>
                        </target>
                        <target>
                           <context value="e4"/>
                           <contextType value="variable"/>
                           <element value="fullUrl"/>
                           <transform value="append"/>
                           <parameter>
                              <valueString value="https://example/List/"/>
                           </parameter>
                           <parameter>
                              <valueId value="uuid4"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="request"/>
                           <contextType value="variable"/>
                           <element value="url"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="List"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="obs2"/>
                           <contextType value="variable"/>
                           <element value="focus"/>
                           <variable value="reference"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="Reference"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="reference"/>
                           <contextType value="variable"/>
                           <element value="reference"/>
                           <transform value="evaluate"/>
                           <parameter>
                              <valueString value="'https://example/List/' + %list1.id"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="reference"/>
                           <source>
                              <context value="section"/>
                           </source>
                           <target>
                              <context value="list1"/>
                              <contextType value="variable"/>
                              <element value="subject"/>
                              <variable value="reference"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="Reference"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="reference"/>
                              <contextType value="variable"/>
                              <element value="reference"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="'https://example/Patient/' + %patient.id"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="listatus"/>
                           <source>
                              <context value="section"/>
                           </source>
                           <target>
                              <context value="list1"/>
                              <contextType value="variable"/>
                              <element value="status"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="current"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="lstmod"/>
                           <source>
                              <context value="section"/>
                           </source>
                           <target>
                              <context value="list1"/>
                              <contextType value="variable"/>
                              <element value="mode"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="working"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="reference"/>
                           <source>
                              <context value="section"/>
                           </source>
                           <target>
                              <context value="list1"/>
                              <contextType value="variable"/>
                              <element value="encounter"/>
                              <variable value="reference"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="Reference"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="reference"/>
                              <contextType value="variable"/>
                              <element value="reference"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="'https://example/Encounter/' + %encounter.id"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="entryList"/>
                           <source>
                              <context value="section"/>
                           </source>
                           <target>
                              <context value="list1"/>
                              <contextType value="variable"/>
                              <element value="entry"/>
                              <variable value="entryList1"/>
                           </target>
                           <rule>
                              <name value="entryAll"/>
                              <source>
                                 <context value="section"/>
                                 <element value="entry"/>
                                 <variable value="entry"/>
                              </source>
                              <rule>
                                 <name value="allergy"/>
                                 <source>
                                    <context value="entry"/>
                                    <element value="act"/>
                                    <variable value="act1"/>
                                 </source>
                                 <target>
                                    <context value="bundle"/>
                                    <contextType value="variable"/>
                                    <element value="entry"/>
                                    <variable value="e5"/>
                                 </target>
                                 <target>
                                    <context value="e5"/>
                                    <contextType value="variable"/>
                                    <element value="request"/>
                                    <variable value="request"/>
                                    <transform value="create"/>
                                    <parameter>
                                       <valueString value="BackboneElement"/>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="request"/>
                                    <contextType value="variable"/>
                                    <element value="method"/>
                                    <transform value="copy"/>
                                    <parameter>
                                       <valueString value="POST"/>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="e5"/>
                                    <contextType value="variable"/>
                                    <element value="resource"/>
                                    <variable value="allergy"/>
                                    <transform value="create"/>
                                    <parameter>
                                       <valueString value="AllergyIntolerance"/>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="allergy"/>
                                    <contextType value="variable"/>
                                    <element value="id"/>
                                    <variable value="uuid5"/>
                                    <transform value="uuid"/>
                                 </target>
                                 <target>
                                    <context value="e5"/>
                                    <contextType value="variable"/>
                                    <element value="fullUrl"/>
                                    <transform value="append"/>
                                    <parameter>
                                       <valueString value="https://example/AllergyIntolerance/"/>
                                    </parameter>
                                    <parameter>
                                       <valueId value="uuid5"/>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="request"/>
                                    <contextType value="variable"/>
                                    <element value="url"/>
                                    <transform value="copy"/>
                                    <parameter>
                                       <valueString value="AllergyIntolerance"/>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="entryList1"/>
                                    <contextType value="variable"/>
                                    <element value="item"/>
                                    <variable value="reference"/>
                                    <transform value="create"/>
                                    <parameter>
                                       <valueString value="Reference"/>
                                    </parameter>
                                 </target>
                                 <target>
                                    <context value="reference"/>
                                    <contextType value="variable"/>
                                    <element value="reference"/>
                                    <transform value="evaluate"/>
                                    <parameter>
                                       <valueString value="'https://example/AllergyIntolerance/' + %allergy.id"/>
                                    </parameter>
                                 </target>
                                 <dependent>
                                    <name value="allergyFunction"/>
                                    <variable value="act1">
                                       <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                          <valueUrl value="id"/>
                                       </extension>
                                    </variable>
                                    <variable value="allergy">
                                       <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                          <valueUrl value="id"/>
                                       </extension>
                                    </variable>
                                    <variable value="patient">
                                       <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                          <valueUrl value="id"/>
                                       </extension>
                                    </variable>
                                    <variable value="encounter">
                                       <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                          <valueUrl value="id"/>
                                       </extension>
                                    </variable>
                                 </dependent>
                              </rule>
                           </rule>
                        </rule>
                     </rule>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="entry"/>
               <source>
                  <context value="section"/>
                  <element value="entry"/>
                  <variable value="entry"/>
               </source>
               <rule>
                  <name value="condition"/>
                  <source>
                     <context value="entry"/>
                     <element value="observation"/>
                  </source>
                  <target>
                     <context value="bundle"/>
                     <contextType value="variable"/>
                     <element value="entry"/>
                     <variable value="e3"/>
                  </target>
                  <target>
                     <context value="e3"/>
                     <contextType value="variable"/>
                     <element value="request"/>
                     <variable value="request"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="BackboneElement"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="request"/>
                     <contextType value="variable"/>
                     <element value="method"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="POST"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="e3"/>
                     <contextType value="variable"/>
                     <element value="resource"/>
                     <variable value="condition"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Condition"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="condition"/>
                     <contextType value="variable"/>
                     <element value="id"/>
                     <variable value="uuid3"/>
                     <transform value="uuid"/>
                  </target>
                  <target>
                     <context value="e3"/>
                     <contextType value="variable"/>
                     <element value="fullUrl"/>
                     <transform value="append"/>
                     <parameter>
                        <valueString value="https://example/Condition/"/>
                     </parameter>
                     <parameter>
                        <valueId value="uuid3"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="request"/>
                     <contextType value="variable"/>
                     <element value="url"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="Condition"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="obs2"/>
                     <contextType value="variable"/>
                     <element value="focus"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Condition/' + %condition.id"/>
                     </parameter>
                  </target>
                  <dependent>
                     <name value="ConditionFunction"/>
                     <variable value="observation">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="condition">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="patient">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="encounter">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="bundle">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                  </dependent>
               </rule>
               <rule>
                  <name value="organizer"/>
                  <source>
                     <context value="entry"/>
                     <element value="organizer"/>
                     <variable value="organizer"/>
                  </source>
                  <rule>
                     <name value="List"/>
                     <source>
                        <context value="section"/>
                     </source>
                     <target>
                        <context value="bundle"/>
                        <contextType value="variable"/>
                        <element value="entry"/>
                        <variable value="e11"/>
                     </target>
                     <target>
                        <context value="e11"/>
                        <contextType value="variable"/>
                        <element value="request"/>
                        <variable value="request"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="BackboneElement"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="method"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="POST"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="e11"/>
                        <contextType value="variable"/>
                        <element value="resource"/>
                        <variable value="list11"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="List"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="list11"/>
                        <contextType value="variable"/>
                        <element value="id"/>
                        <variable value="uuid11"/>
                        <transform value="uuid"/>
                     </target>
                     <target>
                        <context value="e11"/>
                        <contextType value="variable"/>
                        <element value="fullUrl"/>
                        <transform value="append"/>
                        <parameter>
                           <valueString value="https://example/List/"/>
                        </parameter>
                        <parameter>
                           <valueId value="uuid11"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="url"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="List"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="obs2"/>
                        <contextType value="variable"/>
                        <element value="focus"/>
                        <variable value="reference"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Reference"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="reference"/>
                        <contextType value="variable"/>
                        <element value="reference"/>
                        <transform value="evaluate"/>
                        <parameter>
                           <valueString value="'https://example/List/' + %list11.id"/>
                        </parameter>
                     </target>
                     <rule>
                        <name value="reference"/>
                        <source>
                           <context value="section"/>
                        </source>
                        <target>
                           <context value="list11"/>
                           <contextType value="variable"/>
                           <element value="subject"/>
                           <variable value="reference"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="Reference"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="reference"/>
                           <contextType value="variable"/>
                           <element value="reference"/>
                           <transform value="evaluate"/>
                           <parameter>
                              <valueString value="'https://example/Patient/' + %patient.id"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="liststat"/>
                        <source>
                           <context value="section"/>
                        </source>
                        <target>
                           <context value="list11"/>
                           <contextType value="variable"/>
                           <element value="status"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="current"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="listmd"/>
                        <source>
                           <context value="section"/>
                        </source>
                        <target>
                           <context value="list11"/>
                           <contextType value="variable"/>
                           <element value="mode"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="working"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="reference"/>
                        <source>
                           <context value="section"/>
                        </source>
                        <target>
                           <context value="list11"/>
                           <contextType value="variable"/>
                           <element value="encounter"/>
                           <variable value="reference"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="Reference"/>
                           </parameter>
                        </target>
                        <target>
                           <context value="reference"/>
                           <contextType value="variable"/>
                           <element value="reference"/>
                           <transform value="evaluate"/>
                           <parameter>
                              <valueString value="'https://example/Encounter/' + %encounter.id"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="org"/>
                        <source>
                           <context value="organizer"/>
                        </source>
                        <target>
                           <context value="list11"/>
                           <contextType value="variable"/>
                           <element value="entry"/>
                           <variable value="entryList2"/>
                        </target>
                        <rule>
                           <name value="family"/>
                           <source>
                              <context value="organizer"/>
                           </source>
                           <target>
                              <context value="bundle"/>
                              <contextType value="variable"/>
                              <element value="entry"/>
                              <variable value="e12"/>
                           </target>
                           <target>
                              <context value="e12"/>
                              <contextType value="variable"/>
                              <element value="request"/>
                              <variable value="request"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="BackboneElement"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="request"/>
                              <contextType value="variable"/>
                              <element value="method"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="POST"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="e12"/>
                              <contextType value="variable"/>
                              <element value="resource"/>
                              <variable value="familyMember"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="FamilyMemberHistory"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="familyMember"/>
                              <contextType value="variable"/>
                              <element value="id"/>
                              <variable value="uuid12"/>
                              <transform value="uuid"/>
                           </target>
                           <target>
                              <context value="e12"/>
                              <contextType value="variable"/>
                              <element value="fullUrl"/>
                              <transform value="append"/>
                              <parameter>
                                 <valueString value="https://example/FamilyMemberHistory/"/>
                              </parameter>
                              <parameter>
                                 <valueId value="uuid12"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="request"/>
                              <contextType value="variable"/>
                              <element value="url"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="FamilyMemberHistory"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="entryList2"/>
                              <contextType value="variable"/>
                              <element value="item"/>
                              <variable value="reference"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="Reference"/>
                              </parameter>
                           </target>
                           <target>
                              <context value="reference"/>
                              <contextType value="variable"/>
                              <element value="reference"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="'https://example/FamilyMemberHistory/' + %familyMember.id"/>
                              </parameter>
                           </target>
                           <dependent>
                              <name value="FamilyMemberFunction"/>
                              <variable value="organizer">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="familyMember">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="patient">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                           </dependent>
                        </rule>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="PrecedentiEsamiEseguiti"/>
            <source>
               <context value="section"/>
               <condition value="code.code = '30954-2'"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e4"/>
            </target>
            <target>
               <context value="e4"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e4"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs4"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs4"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid4"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e4"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid4"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="result"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs4.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="Observation"/>
               <variable value="observation">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="obs4">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="Diagnosi"/>
            <source>
               <context value="section"/>
               <condition value="code.code = '29548-5'"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e5"/>
            </target>
            <target>
               <context value="e5"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e5"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs5"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs5"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid5"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e5"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid5"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="result"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs5.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="Observation"/>
               <variable value="observation">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="obs5">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryAct"/>
         <source>
            <context value="src"/>
            <element value="act"/>
            <variable value="act"/>
         </source>
         <rule>
            <name value="Prestazioni"/>
            <source>
               <context value="section"/>
               <condition value="code.code = '62387-6'"/>
            </source>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="encounter"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Encounter/' + %encounter.id"/>
               </parameter>
            </target>
            <rule>
               <name value="type"/>
               <source>
                  <context value="act"/>
                  <element value="code"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="encounter"/>
                  <contextType value="variable"/>
                  <element value="type"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="period"/>
               <source>
                  <context value="act"/>
                  <element value="effectiveTime"/>
                  <variable value="effectiveTime"/>
               </source>
               <target>
                  <context value="encounter"/>
                  <contextType value="variable"/>
                  <element value="period"/>
                  <variable value="period"/>
               </target>
               <rule>
                  <name value="val"/>
                  <source>
                     <context value="effectiveTime"/>
                  </source>
                  <target>
                     <context value="period"/>
                     <contextType value="variable"/>
                     <element value="start"/>
                     <variable value="start"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="dateTime"/>
                     </parameter>
                  </target>
                  <dependent>
                     <name value="TSDateTime"/>
                     <variable value="effectiveTime">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="start">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                  </dependent>
               </rule>
            </rule>
            <rule>
               <name value="proceduraMadre"/>
               <source>
                  <context value="act"/>
               </source>
               <target>
                  <context value="bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="e10"/>
               </target>
               <target>
                  <context value="e10"/>
                  <contextType value="variable"/>
                  <element value="request"/>
                  <variable value="request"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="BackboneElement"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="method"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="POST"/>
                  </parameter>
               </target>
               <target>
                  <context value="e10"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="procedureRes"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Procedure"/>
                  </parameter>
               </target>
               <target>
                  <context value="procedureRes"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="uuid10"/>
                  <transform value="uuid"/>
               </target>
               <target>
                  <context value="e10"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                     <valueString value="https://example/Procedure/"/>
                  </parameter>
                  <parameter>
                     <valueId value="uuid10"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="url"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="Procedure"/>
                  </parameter>
               </target>
               <target>
                  <context value="encounter"/>
                  <contextType value="variable"/>
                  <element value="reasonReference"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Procedure/' + %procedureRes.id"/>
                  </parameter>
               </target>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="act"/>
                  </source>
                  <target>
                     <context value="procedureRes"/>
                     <contextType value="variable"/>
                     <element value="subject"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Patient/' + %patient.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="act"/>
                  </source>
                  <target>
                     <context value="procedureRes"/>
                     <contextType value="variable"/>
                     <element value="encounter"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Encounter/' + %encounter.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="status1"/>
                  <source>
                     <context value="act"/>
                     <element value="statusCode"/>
                     <variable value="vvv"/>
                  </source>
                  <target>
                     <context value="procedureRes"/>
                     <contextType value="variable"/>
                     <element value="status"/>
                     <variable value="vvv"/>
                     <transform value="create"/>
                  </target>
               </rule>
               <rule>
                  <name value="status2"/>
                  <source>
                     <context value="act"/>
                     <condition value="statusCode.exists().not()"/>
                  </source>
                  <target>
                     <context value="procedureRes"/>
                     <contextType value="variable"/>
                     <element value="status"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="unknown"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="Relationship"/>
                  <source>
                     <context value="act"/>
                     <element value="entryRelationship"/>
                     <variable value="entryRel"/>
                  </source>
                  <rule>
                     <name value="procedurePrestazioni"/>
                     <source>
                        <context value="entryRel"/>
                        <element value="procedure"/>
                        <variable value="proc"/>
                     </source>
                     <target>
                        <context value="bundle"/>
                        <contextType value="variable"/>
                        <element value="entry"/>
                        <variable value="e9"/>
                     </target>
                     <target>
                        <context value="e9"/>
                        <contextType value="variable"/>
                        <element value="request"/>
                        <variable value="request"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="BackboneElement"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="method"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="POST"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="e9"/>
                        <contextType value="variable"/>
                        <element value="resource"/>
                        <variable value="procedure2"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Procedure"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="procedure2"/>
                        <contextType value="variable"/>
                        <element value="id"/>
                        <variable value="uuid9"/>
                        <transform value="uuid"/>
                     </target>
                     <target>
                        <context value="e9"/>
                        <contextType value="variable"/>
                        <element value="fullUrl"/>
                        <transform value="append"/>
                        <parameter>
                           <valueString value="https://example/Procedure/"/>
                        </parameter>
                        <parameter>
                           <valueId value="uuid9"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="url"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="Procedure"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="procedureRes"/>
                        <contextType value="variable"/>
                        <element value="partOf"/>
                        <variable value="reference"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Reference"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="reference"/>
                        <contextType value="variable"/>
                        <element value="reference"/>
                        <transform value="evaluate"/>
                        <parameter>
                           <valueString value="'https://example/Procedure/' + %procedure2.id"/>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="Procedure"/>
                        <variable value="proc">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="patient">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="encounter">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="procedure2">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="bundle">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                     </dependent>
                  </rule>
                  <rule>
                     <name value="farmacPrestazioni"/>
                     <source>
                        <context value="entryRel"/>
                        <element value="substanceAdministration"/>
                        <variable value="subAdmin"/>
                     </source>
                     <target>
                        <context value="bundle"/>
                        <contextType value="variable"/>
                        <element value="entry"/>
                        <variable value="e8"/>
                     </target>
                     <target>
                        <context value="e8"/>
                        <contextType value="variable"/>
                        <element value="request"/>
                        <variable value="request"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="BackboneElement"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="method"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="POST"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="e8"/>
                        <contextType value="variable"/>
                        <element value="resource"/>
                        <variable value="medAdmin"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="MedicationAdministration"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="medAdmin"/>
                        <contextType value="variable"/>
                        <element value="id"/>
                        <variable value="uuid8"/>
                        <transform value="uuid"/>
                     </target>
                     <target>
                        <context value="e8"/>
                        <contextType value="variable"/>
                        <element value="fullUrl"/>
                        <transform value="append"/>
                        <parameter>
                           <valueString value="https://example/MedicationAdministration/"/>
                        </parameter>
                        <parameter>
                           <valueId value="uuid8"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="url"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="MedicationAdministration"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="procedureRes"/>
                        <contextType value="variable"/>
                        <element value="partOf"/>
                        <variable value="reference"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Reference"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="reference"/>
                        <contextType value="variable"/>
                        <element value="reference"/>
                        <transform value="evaluate"/>
                        <parameter>
                           <valueString value="'https://example/MedicationAdministration/' + %medAdmin.id"/>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="MedicationAdministration"/>
                        <variable value="subAdmin">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="patient">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="encounter">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="medAdmin">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="bundle">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                     </dependent>
                  </rule>
                  <rule>
                     <name value="osservazioniPrestazioni"/>
                     <source>
                        <context value="entryRel"/>
                        <element value="observation"/>
                        <variable value="entryRobs"/>
                     </source>
                     <target>
                        <context value="bundle"/>
                        <contextType value="variable"/>
                        <element value="entry"/>
                        <variable value="e7"/>
                     </target>
                     <target>
                        <context value="e7"/>
                        <contextType value="variable"/>
                        <element value="request"/>
                        <variable value="request"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="BackboneElement"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="method"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="POST"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="e7"/>
                        <contextType value="variable"/>
                        <element value="resource"/>
                        <variable value="obs7"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Observation"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="obs7"/>
                        <contextType value="variable"/>
                        <element value="id"/>
                        <variable value="uuid7"/>
                        <transform value="uuid"/>
                     </target>
                     <target>
                        <context value="e7"/>
                        <contextType value="variable"/>
                        <element value="fullUrl"/>
                        <transform value="append"/>
                        <parameter>
                           <valueString value="https://example/Observation/"/>
                        </parameter>
                        <parameter>
                           <valueId value="uuid7"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="url"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="Observation"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="procedureRes"/>
                        <contextType value="variable"/>
                        <element value="partOf"/>
                        <variable value="reference"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Reference"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="reference"/>
                        <contextType value="variable"/>
                        <element value="reference"/>
                        <transform value="evaluate"/>
                        <parameter>
                           <valueString value="'https://example/Observation/' + %obs7.id"/>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="ObservationPrest"/>
                        <variable value="entryRobs">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="patient">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="encounter">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="obs7">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="bundle">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                     </dependent>
                  </rule>
                  <rule>
                     <name value="procedureGenerichePrestazioni"/>
                     <source>
                        <context value="entryRel"/>
                        <element value="act"/>
                        <variable value="act2"/>
                     </source>
                     <target>
                        <context value="bundle"/>
                        <contextType value="variable"/>
                        <element value="entry"/>
                        <variable value="e6"/>
                     </target>
                     <target>
                        <context value="e6"/>
                        <contextType value="variable"/>
                        <element value="request"/>
                        <variable value="request"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="BackboneElement"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="method"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="POST"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="e6"/>
                        <contextType value="variable"/>
                        <element value="resource"/>
                        <variable value="procedure3"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Procedure"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="procedure3"/>
                        <contextType value="variable"/>
                        <element value="id"/>
                        <variable value="uuid6"/>
                        <transform value="uuid"/>
                     </target>
                     <target>
                        <context value="e6"/>
                        <contextType value="variable"/>
                        <element value="fullUrl"/>
                        <transform value="append"/>
                        <parameter>
                           <valueString value="https://example/Procedure/"/>
                        </parameter>
                        <parameter>
                           <valueId value="uuid6"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="request"/>
                        <contextType value="variable"/>
                        <element value="url"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="Procedure"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="procedureRes"/>
                        <contextType value="variable"/>
                        <element value="partOf"/>
                        <variable value="reference"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Reference"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="reference"/>
                        <contextType value="variable"/>
                        <element value="reference"/>
                        <transform value="evaluate"/>
                        <parameter>
                           <valueString value="'https://example/Procedure/' + %procedure3.id"/>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="Procedure"/>
                        <variable value="act2">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="patient">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="encounter">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="procedure3">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="bundle">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                     </dependent>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="Followup"/>
            <source>
               <context value="section"/>
               <condition value="code.code = '80615-8'"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e12"/>
            </target>
            <target>
               <context value="e12"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e12"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs12"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs12"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid12"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e12"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid12"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="result"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs12.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="Observation"/>
               <variable value="act">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="obs12">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="substanceadmin"/>
         <source>
            <context value="src"/>
            <element value="substanceAdministration"/>
            <variable value="substanceadmin"/>
         </source>
         <rule>
            <name value="TerapiaFarmacologicaConsigliata"/>
            <source>
               <context value="section"/>
               <condition value="code.code = '93341-6'"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e6"/>
            </target>
            <target>
               <context value="e6"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e6"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="medre1"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="MedicationRequest"/>
               </parameter>
            </target>
            <target>
               <context value="medre1"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid6"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e6"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/MedicationRequest/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid6"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="MedicationRequest"/>
               </parameter>
            </target>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="basedOn"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/MedicationRequest/' + %medre1.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="MedicationRequest"/>
               <variable value="substanceadmin">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="medre1">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <documentation value="src.substanceAdministration"/>
      </rule>
      <rule>
         <name value="whereCond"/>
         <source>
            <context value="section"/>
            <condition value="section.entry.exists().not()"/>
         </source>
         <rule>
            <name value="allergyAct"/>
            <source>
               <context value="section"/>
               <condition value="(code.code = '48765-2')"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e2"/>
            </target>
            <target>
               <context value="e2"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e2"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs1"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs1"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid2"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e2"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid2"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="dReport"/>
               <contextType value="variable"/>
               <element value="result"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs1.id"/>
               </parameter>
            </target>
            <rule>
               <name value="reference"/>
               <source>
                  <context value="section"/>
               </source>
               <target>
                  <context value="obs1"/>
                  <contextType value="variable"/>
                  <element value="subject"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Patient/' + %patient.id"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="reference"/>
               <source>
                  <context value="section"/>
               </source>
               <target>
                  <context value="obs1"/>
                  <contextType value="variable"/>
                  <element value="encounter"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Encounter/' + %encounter.id"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="STatusobse"/>
               <source>
                  <context value="section"/>
               </source>
               <target>
                  <context value="obs1"/>
                  <contextType value="variable"/>
                  <element value="status"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="final"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"/>
               <source>
                  <context value="section"/>
                  <element value="code"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="obs1"/>
                  <contextType value="variable"/>
                  <element value="code"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="status"/>
               <source>
                  <context value="section"/>
                  <element value="statusCode"/>
                  <variable value="s"/>
               </source>
               <rule>
                  <name value="codeS"/>
                  <source>
                     <context value="s"/>
                     <element value="code"/>
                     <variable value="cos"/>
                  </source>
                  <target>
                     <context value="obs1"/>
                     <contextType value="variable"/>
                     <element value="status"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="cos"/>
                     </parameter>
                     <parameter>
                        <valueString value="#OBSstatus"/>
                     </parameter>
                     <parameter>
                        <valueString value="code"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="allergytext"/>
               <source>
                  <context value="section"/>
                  <element value="text"/>
                  <variable value="text"/>
               </source>
               <target>
                  <context value="bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="e5"/>
               </target>
               <target>
                  <context value="e5"/>
                  <contextType value="variable"/>
                  <element value="request"/>
                  <variable value="request"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="BackboneElement"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="method"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="POST"/>
                  </parameter>
               </target>
               <target>
                  <context value="e5"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="allergy"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="AllergyIntolerance"/>
                  </parameter>
               </target>
               <target>
                  <context value="allergy"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="uuid5"/>
                  <transform value="uuid"/>
               </target>
               <target>
                  <context value="e5"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                     <valueString value="https://example/AllergyIntolerance/"/>
                  </parameter>
                  <parameter>
                     <valueId value="uuid5"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="url"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="AllergyIntolerance"/>
                  </parameter>
               </target>
               <target>
                  <context value="obs1"/>
                  <contextType value="variable"/>
                  <element value="focus"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/AllergyIntolerance/' + %allergy.id"/>
                  </parameter>
               </target>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="allergy"/>
                     <contextType value="variable"/>
                     <element value="patient"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Patient/' + %patient.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="allergy"/>
                     <contextType value="variable"/>
                     <element value="encounter"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Encounter/' + %encounter.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="status"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="allergy"/>
                     <contextType value="variable"/>
                     <element value="clinicalStatus"/>
                     <variable value="clinicalStatus"/>
                  </target>
                  <rule>
                     <name value="coding"/>
                     <source>
                        <context value="section"/>
                     </source>
                     <target>
                        <context value="clinicalStatus"/>
                        <contextType value="variable"/>
                        <element value="coding"/>
                        <variable value="coding"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Coding"/>
                        </parameter>
                     </target>
                     <rule>
                        <name value="code"/>
                        <source>
                           <context value="section"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="code"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="active"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="system"/>
                        <source>
                           <context value="section"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="system"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="narrative"/>
                  <source>
                     <context value="text"/>
                  </source>
                  <target>
                     <context value="allergy"/>
                     <contextType value="variable"/>
                     <element value="note"/>
                     <variable value="note"/>
                  </target>
                  <rule>
                     <name value="note"/>
                     <source>
                        <context value="text"/>
                        <variable value="t"/>
                     </source>
                     <target>
                        <context value="note"/>
                        <contextType value="variable"/>
                        <element value="text"/>
                        <variable value="textNote"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="string"/>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="EDstring"/>
                        <variable value="t">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="textNote">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                     </dependent>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="MedicationRequest"/>
            <source>
               <context value="section"/>
               <condition value="(code.code = '93341-6')"/>
            </source>
            <rule>
               <name value="txtsec"/>
               <source>
                  <context value="section"/>
                  <element value="text"/>
                  <variable value="text"/>
               </source>
               <target>
                  <context value="bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="e13"/>
               </target>
               <target>
                  <context value="e13"/>
                  <contextType value="variable"/>
                  <element value="request"/>
                  <variable value="request"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="BackboneElement"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="method"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="POST"/>
                  </parameter>
               </target>
               <target>
                  <context value="e13"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="obs13"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="MedicationRequest"/>
                  </parameter>
               </target>
               <target>
                  <context value="obs13"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="uuid13"/>
                  <transform value="uuid"/>
               </target>
               <target>
                  <context value="e13"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                     <valueString value="https://example/MedicationRequest/"/>
                  </parameter>
                  <parameter>
                     <valueId value="uuid13"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="url"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="MedicationRequest"/>
                  </parameter>
               </target>
               <target>
                  <context value="dReport"/>
                  <contextType value="variable"/>
                  <element value="basedOn"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/MedicationRequest/' + %obs13.id"/>
                  </parameter>
               </target>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="subject"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Patient/' + %patient.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="encounter"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Encounter/' + %encounter.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="intent"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="intent"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="order"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="st"/>
                  <source>
                     <context value="section"/>
                     <condition value="statusCode.exists().not()"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="status"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="unknown"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="note"/>
                  <source>
                     <context value="text"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="note"/>
                     <variable value="note"/>
                  </target>
                  <rule>
                     <name value="note"/>
                     <source>
                        <context value="text"/>
                        <variable value="t"/>
                     </source>
                     <target>
                        <context value="note"/>
                        <contextType value="variable"/>
                        <element value="text"/>
                        <variable value="textNote"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="string"/>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="EDstring"/>
                        <variable value="t">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="textNote">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                     </dependent>
                  </rule>
               </rule>
               <rule>
                  <name value="code"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="medication"/>
                     <variable value="code"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="CodeableConcept"/>
                     </parameter>
                  </target>
                  <rule>
                     <name value="string"/>
                     <source>
                        <context value="section"/>
                     </source>
                     <target>
                        <context value="code"/>
                        <contextType value="variable"/>
                        <element value="text"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="string"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="NonConclusion"/>
            <source>
               <context value="section"/>
               <condition value="(code.code = '55110-1').not() and (code.code = '93341-6').not() and (code.code = '48765-2').not()"/>
            </source>
            <rule>
               <name value="txtsec"/>
               <source>
                  <context value="section"/>
                  <element value="text"/>
                  <variable value="text"/>
               </source>
               <target>
                  <context value="bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="e13"/>
               </target>
               <target>
                  <context value="e13"/>
                  <contextType value="variable"/>
                  <element value="request"/>
                  <variable value="request"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="BackboneElement"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="method"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="POST"/>
                  </parameter>
               </target>
               <target>
                  <context value="e13"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="obs13"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Observation"/>
                  </parameter>
               </target>
               <target>
                  <context value="obs13"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="uuid13"/>
                  <transform value="uuid"/>
               </target>
               <target>
                  <context value="e13"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                     <valueString value="https://example/Observation/"/>
                  </parameter>
                  <parameter>
                     <valueId value="uuid13"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="url"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="Observation"/>
                  </parameter>
               </target>
               <target>
                  <context value="dReport"/>
                  <contextType value="variable"/>
                  <element value="result"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Observation/' + %obs13.id"/>
                  </parameter>
               </target>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="subject"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Patient/' + %patient.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="encounter"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Encounter/' + %encounter.id"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="obsst"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="status"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="preliminary"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="obscde"/>
                  <source>
                     <context value="section"/>
                     <element value="code"/>
                     <variable value="vvv"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="code"/>
                     <variable value="vvv"/>
                     <transform value="create"/>
                  </target>
               </rule>
               <rule>
                  <name value="statusS"/>
                  <source>
                     <context value="section"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="status"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="final"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="narrative"/>
                  <source>
                     <context value="text"/>
                  </source>
                  <target>
                     <context value="obs13"/>
                     <contextType value="variable"/>
                     <element value="note"/>
                     <variable value="note"/>
                  </target>
                  <rule>
                     <name value="note"/>
                     <source>
                        <context value="text"/>
                        <variable value="t"/>
                     </source>
                     <target>
                        <context value="note"/>
                        <contextType value="variable"/>
                        <element value="text"/>
                        <variable value="textNote"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="string"/>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="EDstring"/>
                        <variable value="t">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                        <variable value="textNote">
                           <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                              <valueUrl value="id"/>
                           </extension>
                        </variable>
                     </dependent>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="conclusion"/>
            <source>
               <context value="section"/>
               <condition value="(code.code = '55110-1')"/>
            </source>
            <rule>
               <name value="conc"/>
               <source>
                  <context value="section"/>
                  <element value="text"/>
                  <variable value="t"/>
               </source>
               <target>
                  <context value="dReport"/>
                  <contextType value="variable"/>
                  <element value="conclusion"/>
                  <variable value="textConclusion"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="string"/>
                  </parameter>
               </target>
               <dependent>
                  <name value="EDstring"/>
                  <variable value="t">
                     <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                        <valueUrl value="id"/>
                     </extension>
                  </variable>
                  <variable value="textConclusion">
                     <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                        <valueUrl value="id"/>
                     </extension>
                  </variable>
               </dependent>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="Observation"/>
      <typeMode value="none"/>
      <input>
         <name value="cda"/>
         <type value="observation"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="ob"/>
         <type value="Observation"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="reference"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="subject"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="encounter"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Encounter/' + %encounter.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="code"/>
         <source>
            <context value="cda"/>
            <element value="code"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="code"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="Stats"/>
         <source>
            <context value="cda"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="status"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="final"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"/>
         <source>
            <context value="cda"/>
            <type value="INT"/>
            <element value="value"/>
            <variable value="int"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="value"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="int.value"/>
            </parameter>
         </target>
         <documentation value="value datatype"/>
      </rule>
      <rule>
         <name value="value"/>
         <source>
            <context value="cda"/>
            <type value="ST"/>
            <element value="value"/>
            <variable value="st"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="string"/>
            </parameter>
         </target>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="value"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="st.dataString"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="boolean"/>
         <source>
            <context value="cda"/>
            <type value="BL"/>
            <element value="value"/>
            <variable value="boolean"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="value"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="boolean.value"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="val"/>
         <source>
            <context value="cda"/>
            <type value="CE"/>
            <element value="value"/>
            <variable value="val"/>
         </source>
         <rule>
            <name value="coding"/>
            <source>
               <context value="val"/>
            </source>
            <target>
               <context value="ob"/>
               <contextType value="variable"/>
               <element value="value"/>
               <variable value="ce"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="CodeableConcept"/>
               </parameter>
            </target>
            <rule>
               <name value="originalText"/>
               <source>
                  <context value="val"/>
                  <element value="originalText"/>
                  <variable value="originalText"/>
               </source>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="originalText"/>
                     <element value="reference"/>
                     <variable value="reference"/>
                  </source>
                  <target>
                     <context value="ce"/>
                     <contextType value="variable"/>
                     <element value="text"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="reference.value"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="code"/>
               <source>
                  <context value="val"/>
               </source>
               <target>
                  <context value="ce"/>
                  <contextType value="variable"/>
                  <element value="coding"/>
                  <variable value="coding"/>
               </target>
               <rule>
                  <name value="code"/>
                  <source>
                     <context value="val"/>
                     <element value="code"/>
                     <variable value="code"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="code"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="code"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="codeSystem"/>
                  <source>
                     <context value="val"/>
                     <element value="codeSystem"/>
                     <variable value="system"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="system"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="system"/>
                     </parameter>
                     <parameter>
                        <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                     </parameter>
                     <parameter>
                        <valueString value="uri"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="displayName"/>
                  <source>
                     <context value="val"/>
                     <element value="displayName"/>
                     <variable value="display"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="display"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="display"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="translation"/>
               <source>
                  <context value="val"/>
                  <element value="translation"/>
                  <variable value="translation"/>
               </source>
               <target>
                  <context value="ce"/>
                  <contextType value="variable"/>
                  <element value="coding"/>
                  <variable value="coding"/>
               </target>
               <rule>
                  <name value="code"/>
                  <source>
                     <context value="translation"/>
                     <element value="code"/>
                     <variable value="code"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="code"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="code"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="codeSystem"/>
                  <source>
                     <context value="translation"/>
                     <element value="codeSystem"/>
                     <variable value="system"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="system"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="system"/>
                     </parameter>
                     <parameter>
                        <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                     </parameter>
                     <parameter>
                        <valueString value="uri"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="displayName"/>
                  <source>
                     <context value="translation"/>
                     <element value="displayName"/>
                     <variable value="display"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="display"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="display"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="qualifier"/>
                  <source>
                     <context value="translation"/>
                     <element value="qualifier"/>
                     <variable value="qualifier"/>
                  </source>
                  <rule>
                     <name value="value"/>
                     <source>
                        <context value="qualifier"/>
                        <element value="value"/>
                        <variable value="value"/>
                     </source>
                     <target>
                        <context value="ce"/>
                        <contextType value="variable"/>
                        <element value="coding"/>
                        <variable value="coding"/>
                     </target>
                     <rule>
                        <name value="code"/>
                        <source>
                           <context value="value"/>
                           <element value="code"/>
                           <variable value="code"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="code"/>
                           <transform value="cast"/>
                           <parameter>
                              <valueId value="code"/>
                           </parameter>
                           <parameter>
                              <valueString value="string"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="codeSystem"/>
                        <source>
                           <context value="value"/>
                           <element value="codeSystem"/>
                           <variable value="system"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="system"/>
                           <transform value="translate"/>
                           <parameter>
                              <valueId value="system"/>
                           </parameter>
                           <parameter>
                              <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                           </parameter>
                           <parameter>
                              <valueString value="uri"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="displayName"/>
                        <source>
                           <context value="value"/>
                           <element value="displayName"/>
                           <variable value="display"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="display"/>
                           <transform value="cast"/>
                           <parameter>
                              <valueId value="display"/>
                           </parameter>
                           <parameter>
                              <valueString value="string"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="val"/>
         <source>
            <context value="cda"/>
            <type value="CD"/>
            <element value="value"/>
            <variable value="val"/>
         </source>
         <rule>
            <name value="coding"/>
            <source>
               <context value="val"/>
            </source>
            <target>
               <context value="ob"/>
               <contextType value="variable"/>
               <element value="value"/>
               <variable value="ce"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="CodeableConcept"/>
               </parameter>
            </target>
            <rule>
               <name value="originalText"/>
               <source>
                  <context value="val"/>
                  <element value="originalText"/>
                  <variable value="originalText"/>
               </source>
               <rule>
                  <name value="reference"/>
                  <source>
                     <context value="originalText"/>
                     <element value="reference"/>
                     <variable value="reference"/>
                  </source>
                  <target>
                     <context value="ce"/>
                     <contextType value="variable"/>
                     <element value="text"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="reference.value"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="code"/>
               <source>
                  <context value="val"/>
               </source>
               <target>
                  <context value="ce"/>
                  <contextType value="variable"/>
                  <element value="coding"/>
                  <variable value="coding"/>
               </target>
               <rule>
                  <name value="code"/>
                  <source>
                     <context value="val"/>
                     <element value="code"/>
                     <variable value="code"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="code"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="code"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="codeSystem"/>
                  <source>
                     <context value="val"/>
                     <element value="codeSystem"/>
                     <variable value="system"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="system"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="system"/>
                     </parameter>
                     <parameter>
                        <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                     </parameter>
                     <parameter>
                        <valueString value="uri"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="displayName"/>
                  <source>
                     <context value="val"/>
                     <element value="displayName"/>
                     <variable value="display"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="display"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="display"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="translation"/>
               <source>
                  <context value="val"/>
                  <element value="translation"/>
                  <variable value="translation"/>
               </source>
               <target>
                  <context value="ce"/>
                  <contextType value="variable"/>
                  <element value="coding"/>
                  <variable value="coding"/>
               </target>
               <rule>
                  <name value="code"/>
                  <source>
                     <context value="translation"/>
                     <element value="code"/>
                     <variable value="code"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="code"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="code"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="codeSystem"/>
                  <source>
                     <context value="translation"/>
                     <element value="codeSystem"/>
                     <variable value="system"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="system"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="system"/>
                     </parameter>
                     <parameter>
                        <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                     </parameter>
                     <parameter>
                        <valueString value="uri"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="displayName"/>
                  <source>
                     <context value="translation"/>
                     <element value="displayName"/>
                     <variable value="display"/>
                  </source>
                  <target>
                     <context value="coding"/>
                     <contextType value="variable"/>
                     <element value="display"/>
                     <transform value="cast"/>
                     <parameter>
                        <valueId value="display"/>
                     </parameter>
                     <parameter>
                        <valueString value="string"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="qualifier"/>
                  <source>
                     <context value="translation"/>
                     <element value="qualifier"/>
                     <variable value="qualifier"/>
                  </source>
                  <rule>
                     <name value="value"/>
                     <source>
                        <context value="qualifier"/>
                        <element value="value"/>
                        <variable value="value"/>
                     </source>
                     <target>
                        <context value="ce"/>
                        <contextType value="variable"/>
                        <element value="coding"/>
                        <variable value="coding"/>
                     </target>
                     <rule>
                        <name value="code"/>
                        <source>
                           <context value="value"/>
                           <element value="code"/>
                           <variable value="code"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="code"/>
                           <transform value="cast"/>
                           <parameter>
                              <valueId value="code"/>
                           </parameter>
                           <parameter>
                              <valueString value="string"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="codeSystem"/>
                        <source>
                           <context value="value"/>
                           <element value="codeSystem"/>
                           <variable value="system"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="system"/>
                           <transform value="translate"/>
                           <parameter>
                              <valueId value="system"/>
                           </parameter>
                           <parameter>
                              <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                           </parameter>
                           <parameter>
                              <valueString value="uri"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="displayName"/>
                        <source>
                           <context value="value"/>
                           <element value="displayName"/>
                           <variable value="display"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="display"/>
                           <transform value="cast"/>
                           <parameter>
                              <valueId value="display"/>
                           </parameter>
                           <parameter>
                              <valueString value="string"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="valueQuantity"/>
         <source>
            <context value="cda"/>
            <type value="PQ"/>
            <element value="value"/>
            <variable value="val"/>
         </source>
         <rule>
            <name value="quantity"/>
            <source>
               <context value="val"/>
            </source>
            <target>
               <context value="ob"/>
               <contextType value="variable"/>
               <element value="value"/>
               <variable value="quantity"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Quantity"/>
               </parameter>
            </target>
            <rule>
               <name value="value"/>
               <source>
                  <context value="val"/>
                  <element value="value"/>
                  <variable value="value"/>
               </source>
               <target>
                  <context value="quantity"/>
                  <contextType value="variable"/>
                  <element value="value"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueId value="value"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="unit"/>
               <source>
                  <context value="val"/>
                  <element value="unit"/>
                  <variable value="unit"/>
               </source>
               <target>
                  <context value="quantity"/>
                  <contextType value="variable"/>
                  <element value="unit"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueId value="unit"/>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="value1"/>
         <source>
            <context value="cda"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(value.exists())"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="effective"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="dateTime"/>
            </parameter>
         </target>
         <dependent>
            <name value="TSDateTime"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="valuePeriod"/>
         <source>
            <context value="cda"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(low.exists())"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="effective"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Period"/>
            </parameter>
         </target>
         <dependent>
            <name value="IVLTSPeriod"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="note"/>
         <source>
            <context value="cda"/>
            <element value="text"/>
            <variable value="text"/>
         </source>
         <target>
            <context value="ob"/>
            <contextType value="variable"/>
            <element value="note"/>
            <variable value="note"/>
         </target>
         <rule>
            <name value="text"/>
            <source>
               <context value="text"/>
               <element value="reference"/>
               <variable value="reference"/>
            </source>
            <target>
               <context value="note"/>
               <contextType value="variable"/>
               <element value="text"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="reference.value"/>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="status"/>
         <source>
            <context value="cda"/>
            <element value="statusCode"/>
            <variable value="s"/>
         </source>
         <rule>
            <name value="codeS"/>
            <source>
               <context value="s"/>
               <element value="code"/>
               <variable value="cos"/>
            </source>
            <target>
               <context value="ob"/>
               <contextType value="variable"/>
               <element value="status"/>
               <transform value="translate"/>
               <parameter>
                  <valueId value="cos"/>
               </parameter>
               <parameter>
                  <valueString value="#OBSstatus"/>
               </parameter>
               <parameter>
                  <valueString value="code"/>
               </parameter>
            </target>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ConditionFunction"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="cdaElement"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="Condition"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="code"/>
         <source>
            <context value="src"/>
            <element value="code"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="category"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="subject"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="encounter"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Encounter/' + %encounter.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="verifstatus"/>
         <source>
            <context value="src"/>
            <element value="statusCode"/>
            <variable value="stscode"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="verificationStatus"/>
            <variable value="verifstatus"/>
         </target>
         <rule>
            <name value="coding"/>
            <source>
               <context value="stscode"/>
               <variable value="codeS"/>
            </source>
            <target>
               <context value="verifstatus"/>
               <contextType value="variable"/>
               <element value="coding"/>
               <variable value="coding"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Coding"/>
               </parameter>
            </target>
            <rule>
               <name value="code"/>
               <source>
                  <context value="codeS"/>
                  <element value="code"/>
               </source>
               <target>
                  <context value="coding"/>
                  <contextType value="variable"/>
                  <element value="code"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="confirmed"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="system"/>
               <source>
                  <context value="codeS"/>
               </source>
               <target>
                  <context value="coding"/>
                  <contextType value="variable"/>
                  <element value="system"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="http://terminology.hl7.org/CodeSystem/condition-ver-status"/>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="display"/>
               <source>
                  <context value="codeS"/>
               </source>
               <target>
                  <context value="coding"/>
                  <contextType value="variable"/>
                  <element value="display"/>
                  <transform value="cast"/>
                  <parameter>
                     <valueString value="Confirmed"/>
                  </parameter>
                  <parameter>
                     <valueString value="string"/>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="valuePeriod"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="onset"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Period"/>
            </parameter>
         </target>
         <dependent>
            <name value="IVLTSPeriod"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="value"/>
         <source>
            <context value="src"/>
            <element value="value"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="code"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="entryR"/>
         <source>
            <context value="src"/>
            <element value="entryRelationship"/>
            <variable value="entryRelationship"/>
         </source>
         <rule>
            <name value="EntryRelObsevation"/>
            <source>
               <context value="entryRelationship"/>
               <element value="observation"/>
               <variable value="obsentry"/>
            </source>
            <rule>
               <name value="observation"/>
               <source>
                  <context value="obsentry"/>
                  <element value="code"/>
                  <condition value="code = '89261-2'"/>
               </source>
               <rule>
                  <name value="observation"/>
                  <source>
                     <context value="obsentry"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="evidence"/>
                     <variable value="evidence"/>
                  </target>
                  <target>
                     <context value="bundle"/>
                     <contextType value="variable"/>
                     <element value="entry"/>
                     <variable value="e1"/>
                  </target>
                  <target>
                     <context value="e1"/>
                     <contextType value="variable"/>
                     <element value="request"/>
                     <variable value="request"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="BackboneElement"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="request"/>
                     <contextType value="variable"/>
                     <element value="method"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="POST"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="e1"/>
                     <contextType value="variable"/>
                     <element value="resource"/>
                     <variable value="obsy"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Observation"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="obsy"/>
                     <contextType value="variable"/>
                     <element value="id"/>
                     <variable value="uuid1"/>
                     <transform value="uuid"/>
                  </target>
                  <target>
                     <context value="e1"/>
                     <contextType value="variable"/>
                     <element value="fullUrl"/>
                     <transform value="append"/>
                     <parameter>
                        <valueString value="https://example/Observation/"/>
                     </parameter>
                     <parameter>
                        <valueId value="uuid1"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="request"/>
                     <contextType value="variable"/>
                     <element value="url"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueString value="Observation"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="evidence"/>
                     <contextType value="variable"/>
                     <element value="detail"/>
                     <variable value="reference"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Reference"/>
                     </parameter>
                  </target>
                  <target>
                     <context value="reference"/>
                     <contextType value="variable"/>
                     <element value="reference"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="'https://example/Observation/' + %obsy.id"/>
                     </parameter>
                  </target>
                  <dependent>
                     <name value="Observation"/>
                     <variable value="obsentry">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="patient">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="encounter">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="obsy">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="bundle">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                  </dependent>
               </rule>
            </rule>
            <rule>
               <name value="clinicalStatus2"/>
               <source>
                  <context value="obsentry"/>
                  <element value="code"/>
                  <condition value="code = '33999-4'"/>
               </source>
               <rule>
                  <name value="clinicalstatus"/>
                  <source>
                     <context value="obsentry"/>
                     <element value="value"/>
                     <variable value="value"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="clinicalStatus"/>
                     <variable value="clinicalstatus"/>
                  </target>
                  <rule>
                     <name value="coding"/>
                     <source>
                        <context value="value"/>
                        <variable value="val"/>
                     </source>
                     <target>
                        <context value="clinicalstatus"/>
                        <contextType value="variable"/>
                        <element value="coding"/>
                        <variable value="coding"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Coding"/>
                        </parameter>
                     </target>
                     <rule>
                        <name value="code"/>
                        <source>
                           <context value="val"/>
                           <condition value="(code = 'LA9041-0')"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="code"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="resolved"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="code"/>
                        <source>
                           <context value="val"/>
                           <condition value="(code = 'LA18632-2')"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="code"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="inactive"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="code"/>
                        <source>
                           <context value="val"/>
                           <condition value="(code = 'LA16666-2')"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="code"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="active"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="system"/>
                        <source>
                           <context value="val"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="system"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueString value="http://terminology.hl7.org/CodeSystem/condition-clinical"/>
                           </parameter>
                        </target>
                     </rule>
                     <rule>
                        <name value="display"/>
                        <source>
                           <context value="val"/>
                           <element value="displayName"/>
                           <variable value="display"/>
                        </source>
                        <target>
                           <context value="coding"/>
                           <contextType value="variable"/>
                           <element value="display"/>
                           <transform value="cast"/>
                           <parameter>
                              <valueId value="display"/>
                           </parameter>
                           <parameter>
                              <valueString value="string"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
                  <rule>
                     <name value="text"/>
                     <source>
                        <context value="obsentry"/>
                        <element value="text"/>
                        <variable value="text"/>
                     </source>
                     <rule>
                        <name value="text"/>
                        <source>
                           <context value="text"/>
                           <element value="reference"/>
                           <variable value="reference"/>
                        </source>
                        <target>
                           <context value="clinicalstatus"/>
                           <contextType value="variable"/>
                           <element value="text"/>
                           <transform value="evaluate"/>
                           <parameter>
                              <valueString value="reference.value"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="Procedure"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="procedure"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="Procedure"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="subject"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="encounter"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Encounter/' + %encounter.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="status1"/>
         <source>
            <context value="src"/>
            <element value="statusCode"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="status2"/>
         <source>
            <context value="src"/>
            <condition value="statusCode.exists().not()"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="unknown"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"/>
         <source>
            <context value="src"/>
            <element value="id"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="identifier"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="code"/>
         <source>
            <context value="src"/>
            <element value="code"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="code"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="value1"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(value.exists())"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="performed"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="dateTime"/>
            </parameter>
         </target>
         <dependent>
            <name value="TSDateTime"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="valuePeriod"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(low.exists())"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="performed"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Period"/>
            </parameter>
         </target>
         <dependent>
            <name value="IVLTSPeriod"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="methodCode"/>
         <source>
            <context value="src"/>
            <element value="methodCode"/>
            <variable value="methodCode"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="extension"/>
            <variable value="ext1"/>
         </target>
         <dependent>
            <name value="ITMethodExt"/>
            <variable value="methodCode">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="ext1">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="participant"/>
         <source>
            <context value="src"/>
            <element value="participant"/>
            <variable value="participant"/>
         </source>
         <rule>
            <name value="participantRole"/>
            <source>
               <context value="participant"/>
               <element value="participantRole"/>
               <variable value="participantRole"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="performer"/>
               <variable value="performer"/>
            </target>
            <rule>
               <name value="device"/>
               <source>
                  <context value="participantRole"/>
                  <element value="playingDevice"/>
                  <variable value="device"/>
               </source>
               <target>
                  <context value="bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="e2"/>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="request"/>
                  <variable value="request"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="BackboneElement"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="method"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="POST"/>
                  </parameter>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="deviceRes"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Device"/>
                  </parameter>
               </target>
               <target>
                  <context value="deviceRes"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="uuid2"/>
                  <transform value="uuid"/>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                     <valueString value="https://example/Device/"/>
                  </parameter>
                  <parameter>
                     <valueId value="uuid2"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="url"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="Device"/>
                  </parameter>
               </target>
               <target>
                  <context value="performer"/>
                  <contextType value="variable"/>
                  <element value="actor"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Device/' + %deviceRes.id"/>
                  </parameter>
               </target>
               <rule>
                  <name value="manufacturer"/>
                  <source>
                     <context value="device"/>
                     <element value="manufacturerModelName"/>
                     <variable value="manufacturerModelName"/>
                  </source>
                  <rule>
                     <name value="manuf"/>
                     <source>
                        <context value="manufacturerModelName"/>
                        <element value="displayName"/>
                        <variable value="displayName"/>
                     </source>
                     <target>
                        <context value="deviceRes"/>
                        <contextType value="variable"/>
                        <element value="manufacturer"/>
                        <transform value="cast"/>
                        <parameter>
                           <valueId value="displayName"/>
                        </parameter>
                        <parameter>
                           <valueString value="string"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="code"/>
                  <source>
                     <context value="device"/>
                     <element value="code"/>
                     <variable value="vvv"/>
                  </source>
                  <target>
                     <context value="deviceRes"/>
                     <contextType value="variable"/>
                     <element value="type"/>
                     <variable value="vvv"/>
                     <transform value="create"/>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="entryRelProcedure"/>
         <source>
            <context value="src"/>
            <element value="entryRelationship"/>
            <variable value="entryR"/>
         </source>
         <rule>
            <name value="Parametri"/>
            <source>
               <context value="entryR"/>
               <element value="observation"/>
               <variable value="observation"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e3"/>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs1"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs1"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid3"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid3"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="partOf"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs1.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="Observation"/>
               <variable value="observation">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="obs1">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="act"/>
            <source>
               <context value="entryR"/>
               <element value="act"/>
               <variable value="act"/>
            </source>
            <rule>
               <name value="note"/>
               <source>
                  <context value="act"/>
                  <element value="text"/>
                  <variable value="text"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="note"/>
                  <variable value="note"/>
               </target>
               <rule>
                  <name value="text"/>
                  <source>
                     <context value="text"/>
                     <element value="reference"/>
                     <variable value="reference"/>
                  </source>
                  <target>
                     <context value="note"/>
                     <contextType value="variable"/>
                     <element value="text"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="reference.value"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ITMethodExt"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="ext"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="url"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="ext"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="http://hl7.org/fhir/StructureDefinition/procedure-method"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="ext"/>
            <contextType value="variable"/>
            <element value="value"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="CodeableConcept"/>
            </parameter>
         </target>
         <dependent>
            <name value="CECodeableConcept"/>
            <variable value="src">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="MedicationAdministration"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="substanceAdministration"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="MedicationAdministration"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="subject"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="context"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Encounter/' + %encounter.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="status1"/>
         <source>
            <context value="src"/>
            <element value="statusCode"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="status2"/>
         <source>
            <context value="src"/>
            <condition value="statusCode.exists().not()"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="unknown"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"/>
         <source>
            <context value="src"/>
            <element value="id"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="identifier"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="value1"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(value.exists())"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="effective"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="dateTime"/>
            </parameter>
         </target>
         <dependent>
            <name value="TSDateTime"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="valuePeriod"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(low.exists())"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="effective"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Period"/>
            </parameter>
         </target>
         <dependent>
            <name value="IVLTSPeriod"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="dosage"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="dosage"/>
            <variable value="dosage"/>
         </target>
         <rule>
            <name value="route"/>
            <source>
               <context value="src"/>
               <element value="routeCode"/>
               <variable value="vvv"/>
            </source>
            <target>
               <context value="dosage"/>
               <contextType value="variable"/>
               <element value="route"/>
               <variable value="vvv"/>
               <transform value="create"/>
            </target>
         </rule>
         <rule>
            <name value="repQ"/>
            <source>
               <context value="src"/>
               <element value="repeatNumber"/>
               <variable value="repeatNumber"/>
            </source>
            <target>
               <context value="dosage"/>
               <contextType value="variable"/>
               <element value="rate"/>
               <variable value="value"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="SimpleQuantity"/>
               </parameter>
            </target>
            <dependent>
               <name value="PQQuantity"/>
               <variable value="repeatNumber">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="value">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="site"/>
            <source>
               <context value="src"/>
               <element value="approachSiteCode"/>
               <variable value="vvv"/>
            </source>
            <target>
               <context value="dosage"/>
               <contextType value="variable"/>
               <element value="site"/>
               <variable value="vvv"/>
               <transform value="create"/>
            </target>
         </rule>
         <rule>
            <name value="site"/>
            <source>
               <context value="src"/>
               <element value="targetSiteCode"/>
               <variable value="vvv"/>
            </source>
            <target>
               <context value="dosage"/>
               <contextType value="variable"/>
               <element value="site"/>
               <variable value="vvv"/>
               <transform value="create"/>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="medication"/>
         <source>
            <context value="src"/>
            <element value="consumable"/>
            <variable value="consumable"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e1"/>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="POST"/>
            </parameter>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="medication"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Medication"/>
            </parameter>
         </target>
         <target>
            <context value="medication"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid1"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/Medication/"/>
            </parameter>
            <parameter>
               <valueId value="uuid1"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="Medication"/>
            </parameter>
         </target>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="medication"/>
            <variable value="medref"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="medref"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Medication/' + %medication.id"/>
            </parameter>
         </target>
         <dependent>
            <name value="Medication"/>
            <variable value="src">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="medication">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="patient">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="bundle">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="participant"/>
         <source>
            <context value="src"/>
            <element value="participant"/>
            <variable value="participant"/>
         </source>
         <rule>
            <name value="participantRole"/>
            <source>
               <context value="participant"/>
               <element value="participantRole"/>
               <variable value="participantRole"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="performer"/>
               <variable value="performer"/>
            </target>
            <rule>
               <name value="device"/>
               <source>
                  <context value="participantRole"/>
                  <element value="device"/>
                  <variable value="device"/>
               </source>
               <target>
                  <context value="bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="e2"/>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="request"/>
                  <variable value="request"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="BackboneElement"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="method"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="POST"/>
                  </parameter>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="deviceRes"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Device"/>
                  </parameter>
               </target>
               <target>
                  <context value="deviceRes"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="uuid2"/>
                  <transform value="uuid"/>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                     <valueString value="https://example/Device/"/>
                  </parameter>
                  <parameter>
                     <valueId value="uuid2"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="url"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="Device"/>
                  </parameter>
               </target>
               <target>
                  <context value="performer"/>
                  <contextType value="variable"/>
                  <element value="actor"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Device/' + %deviceRes.id"/>
                  </parameter>
               </target>
               <rule>
                  <name value="manufacturer"/>
                  <source>
                     <context value="device"/>
                     <element value="ManufacturerModelName"/>
                     <variable value="ManufacturerModelName"/>
                  </source>
                  <rule>
                     <name value="manuf"/>
                     <source>
                        <context value="ManufacturerModelName"/>
                        <element value="code"/>
                        <variable value="vvv"/>
                     </source>
                     <target>
                        <context value="deviceRes"/>
                        <contextType value="variable"/>
                        <element value="manufacturer"/>
                        <variable value="vvv"/>
                        <transform value="create"/>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="entryRelMedication"/>
         <source>
            <context value="src"/>
            <element value="entryRelationship"/>
            <variable value="entryR"/>
         </source>
         <rule>
            <name value="Parametri"/>
            <source>
               <context value="entryR"/>
               <element value="observation"/>
               <variable value="observation"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e3"/>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs1"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs1"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid3"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid3"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="partOf"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs1.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="Observation"/>
               <variable value="observation">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="obs1">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="act"/>
            <source>
               <context value="entryR"/>
               <element value="act"/>
               <variable value="act"/>
            </source>
            <rule>
               <name value="note"/>
               <source>
                  <context value="act"/>
                  <element value="text"/>
                  <variable value="text"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="note"/>
                  <variable value="note"/>
               </target>
               <rule>
                  <name value="text"/>
                  <source>
                     <context value="text"/>
                     <element value="reference"/>
                     <variable value="reference"/>
                  </source>
                  <target>
                     <context value="note"/>
                     <contextType value="variable"/>
                     <element value="text"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="reference.value"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="medRequ"/>
         <source>
            <context value="src"/>
            <condition value="(src.doseQuantity.exists() or src.rateQuantity.exists())"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e1"/>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="POST"/>
            </parameter>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="medicationRq"/>
            <transform value="create"/>
            <parameter>
               <valueString value="MedicationRequest"/>
            </parameter>
         </target>
         <target>
            <context value="medicationRq"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid1"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/MedicationRequest/"/>
            </parameter>
            <parameter>
               <valueId value="uuid1"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="MedicationRequest"/>
            </parameter>
         </target>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/MedicationRequest/' + %medicationRq.id"/>
            </parameter>
         </target>
         <dependent>
            <name value="MedicationRequest"/>
            <variable value="src">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="patient">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="encounter">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="medicationRq">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="bundle">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="note"/>
         <source>
            <context value="src"/>
            <element value="text"/>
            <variable value="text"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="note"/>
            <variable value="note"/>
         </target>
         <rule>
            <name value="text"/>
            <source>
               <context value="text"/>
            </source>
            <target>
               <context value="note"/>
               <contextType value="variable"/>
               <element value="text"/>
            </target>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ObservationPrest"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="observation"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="Observation"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="subject"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="encounter"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Encounter/' + %encounter.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="status"/>
         <source>
            <context value="src"/>
            <element value="statusCode"/>
            <variable value="s"/>
         </source>
         <rule>
            <name value="codeS"/>
            <source>
               <context value="s"/>
               <element value="code"/>
               <variable value="cos"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="status"/>
               <transform value="translate"/>
               <parameter>
                  <valueId value="cos"/>
               </parameter>
               <parameter>
                  <valueString value="#OBSstatus"/>
               </parameter>
               <parameter>
                  <valueString value="code"/>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="id"/>
         <source>
            <context value="src"/>
            <element value="id"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="identifier"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="code"/>
         <source>
            <context value="src"/>
            <element value="code"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="code"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="value1"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(value.exists())"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="perfomed"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="dateTime"/>
            </parameter>
         </target>
         <dependent>
            <name value="TSDateTime"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="valuePeriod"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
            <condition value="(low.exists())"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="perfomed"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Period"/>
            </parameter>
         </target>
         <dependent>
            <name value="IVLTSPeriod"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="methodCode"/>
         <source>
            <context value="src"/>
            <element value="methodCode"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="method"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="participant"/>
         <source>
            <context value="src"/>
            <element value="participant"/>
            <variable value="participant"/>
         </source>
         <rule>
            <name value="participantRole"/>
            <source>
               <context value="participant"/>
               <element value="participantRole"/>
               <variable value="participantRole"/>
            </source>
            <rule>
               <name value="device"/>
               <source>
                  <context value="participantRole"/>
                  <element value="device"/>
                  <variable value="device"/>
               </source>
               <target>
                  <context value="bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="e2"/>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="request"/>
                  <variable value="request"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="BackboneElement"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="method"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="POST"/>
                  </parameter>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="deviceRes"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Device"/>
                  </parameter>
               </target>
               <target>
                  <context value="deviceRes"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="uuid2"/>
                  <transform value="uuid"/>
               </target>
               <target>
                  <context value="e2"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                     <valueString value="https://example/Device/"/>
                  </parameter>
                  <parameter>
                     <valueId value="uuid2"/>
                  </parameter>
               </target>
               <target>
                  <context value="request"/>
                  <contextType value="variable"/>
                  <element value="url"/>
                  <transform value="copy"/>
                  <parameter>
                     <valueString value="Device"/>
                  </parameter>
               </target>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="device"/>
                  <variable value="reference"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Reference"/>
                  </parameter>
               </target>
               <target>
                  <context value="reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="evaluate"/>
                  <parameter>
                     <valueString value="'https://example/Device/' + %deviceRes.id"/>
                  </parameter>
               </target>
               <rule>
                  <name value="manufacturer"/>
                  <source>
                     <context value="device"/>
                     <element value="ManufacturerModelName"/>
                     <variable value="ManufacturerModelName"/>
                  </source>
                  <rule>
                     <name value="manuf"/>
                     <source>
                        <context value="ManufacturerModelName"/>
                        <element value="code"/>
                        <variable value="vvv"/>
                     </source>
                     <target>
                        <context value="deviceRes"/>
                        <contextType value="variable"/>
                        <element value="manufacturer"/>
                        <variable value="vvv"/>
                        <transform value="create"/>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="entryRelOsservazioni"/>
         <source>
            <context value="src"/>
            <element value="entryRelationship"/>
            <variable value="entryR"/>
         </source>
         <rule>
            <name value="Parametri"/>
            <source>
               <context value="entryR"/>
               <element value="observation"/>
               <variable value="observation"/>
            </source>
            <target>
               <context value="bundle"/>
               <contextType value="variable"/>
               <element value="entry"/>
               <variable value="e3"/>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="request"/>
               <variable value="request"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="BackboneElement"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="method"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="POST"/>
               </parameter>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="resource"/>
               <variable value="obs1"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="obs1"/>
               <contextType value="variable"/>
               <element value="id"/>
               <variable value="uuid3"/>
               <transform value="uuid"/>
            </target>
            <target>
               <context value="e3"/>
               <contextType value="variable"/>
               <element value="fullUrl"/>
               <transform value="append"/>
               <parameter>
                  <valueString value="https://example/Observation/"/>
               </parameter>
               <parameter>
                  <valueId value="uuid3"/>
               </parameter>
            </target>
            <target>
               <context value="request"/>
               <contextType value="variable"/>
               <element value="url"/>
               <transform value="copy"/>
               <parameter>
                  <valueString value="Observation"/>
               </parameter>
            </target>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="hasMember"/>
               <variable value="reference"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Reference"/>
               </parameter>
            </target>
            <target>
               <context value="reference"/>
               <contextType value="variable"/>
               <element value="reference"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="'https://example/Observation/' + %obs1.id"/>
               </parameter>
            </target>
            <dependent>
               <name value="Observation"/>
               <variable value="observation">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="patient">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="encounter">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="obs1">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="act"/>
            <source>
               <context value="entryR"/>
               <element value="act"/>
               <variable value="act"/>
            </source>
            <rule>
               <name value="note"/>
               <source>
                  <context value="act"/>
                  <element value="text"/>
                  <variable value="text"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="note"/>
                  <variable value="note"/>
               </target>
               <rule>
                  <name value="text"/>
                  <source>
                     <context value="text"/>
                     <element value="reference"/>
                     <variable value="reference"/>
                  </source>
                  <target>
                     <context value="note"/>
                     <contextType value="variable"/>
                     <element value="text"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="reference.value"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="MedicationRequest"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="substanceAdministration"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="MedicationRequest"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="subject"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
         <documentation value="default  + mandatory"/>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="encounter"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Encounter/' + %encounter.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="intent"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="intent"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="order"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="st"/>
         <source>
            <context value="src"/>
            <condition value="statusCode.exists().not()"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="unknown"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="status"/>
         <source>
            <context value="src"/>
            <element value="statusCode"/>
            <variable value="sc"/>
         </source>
         <rule>
            <name value="codeS"/>
            <source>
               <context value="sc"/>
               <element value="code"/>
               <variable value="cos"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="status"/>
               <transform value="translate"/>
               <parameter>
                  <valueId value="cos"/>
               </parameter>
               <parameter>
                  <valueString value="#MedicationStatusMap"/>
               </parameter>
               <parameter>
                  <valueString value="code"/>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="note"/>
         <source>
            <context value="src"/>
            <element value="text"/>
            <variable value="txt"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="note"/>
            <variable value="note"/>
         </target>
         <rule>
            <name value="text"/>
            <source>
               <context value="txt"/>
               <element value="reference"/>
               <variable value="reference"/>
            </source>
            <target>
               <context value="note"/>
               <contextType value="variable"/>
               <element value="text"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="reference.value"/>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="period"/>
         <source>
            <context value="src"/>
            <type value="IVL_TS"/>
            <element value="effectiveTime"/>
            <variable value="eff"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="dosageInstruction"/>
            <variable value="dosage"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Dosage"/>
            </parameter>
         </target>
         <rule>
            <name value="timing"/>
            <source>
               <context value="eff"/>
            </source>
            <target>
               <context value="dosage"/>
               <contextType value="variable"/>
               <element value="timing"/>
               <variable value="timing"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Timing"/>
               </parameter>
            </target>
            <rule>
               <name value="rep"/>
               <source>
                  <context value="eff"/>
               </source>
               <target>
                  <context value="timing"/>
                  <contextType value="variable"/>
                  <element value="repeat"/>
                  <variable value="rep"/>
               </target>
               <rule>
                  <name value="value1"/>
                  <source>
                     <context value="eff"/>
                     <variable value="eff"/>
                     <condition value="(value.exists())"/>
                  </source>
                  <target>
                     <context value="rep"/>
                     <contextType value="variable"/>
                     <element value="bounds"/>
                     <variable value="value"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="dateTime"/>
                     </parameter>
                  </target>
                  <dependent>
                     <name value="TSDateTime"/>
                     <variable value="eff">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="value">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                  </dependent>
               </rule>
               <rule>
                  <name value="valuePeriod"/>
                  <source>
                     <context value="eff"/>
                     <variable value="eff"/>
                     <condition value="(low.exists())"/>
                  </source>
                  <target>
                     <context value="rep"/>
                     <contextType value="variable"/>
                     <element value="bounds"/>
                     <variable value="value"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Period"/>
                     </parameter>
                  </target>
                  <dependent>
                     <name value="IVLTSPeriod"/>
                     <variable value="eff">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="value">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="period"/>
         <source>
            <context value="src"/>
            <type value="EIVL_TS"/>
            <element value="effectiveTime"/>
            <variable value="effe"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="dosageInstruction"/>
            <variable value="dosage"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Dosage"/>
            </parameter>
         </target>
         <rule>
            <name value="timing"/>
            <source>
               <context value="effe"/>
            </source>
            <target>
               <context value="dosage"/>
               <contextType value="variable"/>
               <element value="timing"/>
               <variable value="timing"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Timing"/>
               </parameter>
            </target>
            <rule>
               <name value="rep"/>
               <source>
                  <context value="effe"/>
               </source>
               <target>
                  <context value="timing"/>
                  <contextType value="variable"/>
                  <element value="repeat"/>
                  <variable value="rep"/>
               </target>
               <rule>
                  <name value="eventCode"/>
                  <source>
                     <context value="effe"/>
                     <element value="eventCode"/>
                     <variable value="ev"/>
                  </source>
                  <target>
                     <context value="rep"/>
                     <contextType value="variable"/>
                     <element value="when"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="ev.code"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="tim"/>
         <source>
            <context value="src"/>
            <type value="IVL_TS"/>
            <element value="effectiveTime"/>
            <variable value="eff"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="dosageInstruction"/>
            <variable value="dosage"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Dosage"/>
            </parameter>
         </target>
         <target>
            <context value="dosage"/>
            <contextType value="variable"/>
            <element value="timing"/>
            <variable value="timing"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Timing"/>
            </parameter>
         </target>
         <target>
            <context value="timing"/>
            <contextType value="variable"/>
            <element value="event"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="eff.value"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="eff"/>
         <source>
            <context value="src"/>
            <type value="PIVL_TS"/>
            <element value="effectiveTime"/>
            <variable value="eff"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="dosageInstruction"/>
            <variable value="dosage"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Dosage"/>
            </parameter>
         </target>
         <rule>
            <name value="cod"/>
            <source>
               <context value="eff"/>
            </source>
            <target>
               <context value="dosage"/>
               <contextType value="variable"/>
               <element value="timing"/>
               <variable value="timing"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Timing"/>
               </parameter>
            </target>
            <dependent>
               <name value="periodTiming"/>
               <variable value="eff">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="timing">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="condition"/>
         <source>
            <context value="src"/>
            <condition value="(src.doseQuantity.exists() or src.rateQuantity.exists())"/>
         </source>
         <rule>
            <name value="dosageIn"/>
            <source>
               <context value="src"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="dosageInstruction"/>
               <variable value="dosageInstruction"/>
               <transform value="create"/>
               <parameter>
                  <valueString value="Dosage"/>
               </parameter>
            </target>
            <rule>
               <name value="doseQuantity"/>
               <source>
                  <context value="src"/>
                  <element value="doseQuantity"/>
                  <variable value="doseQuant"/>
               </source>
               <rule>
                  <name value="ot"/>
                  <source>
                     <context value="doseQuant"/>
                     <element value="originalText"/>
                     <variable value="ot"/>
                  </source>
                  <rule>
                     <name value="reference"/>
                     <source>
                        <context value="ot"/>
                        <element value="reference"/>
                        <variable value="vvv"/>
                     </source>
                     <target>
                        <context value="dosageInstruction"/>
                        <contextType value="variable"/>
                        <element value="text"/>
                        <variable value="vvv"/>
                        <transform value="create"/>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="dosageRate"/>
                  <source>
                     <context value="doseQuant"/>
                  </source>
                  <target>
                     <context value="dosageInstruction"/>
                     <contextType value="variable"/>
                     <element value="doseAndRate"/>
                     <variable value="dosageRate"/>
                  </target>
                  <rule>
                     <name value="d"/>
                     <source>
                        <context value="doseQuant"/>
                     </source>
                     <target>
                        <context value="dosageRate"/>
                        <contextType value="variable"/>
                        <element value="dose"/>
                        <variable value="d"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Range"/>
                        </parameter>
                     </target>
                     <rule>
                        <name value="low"/>
                        <source>
                           <context value="doseQuant"/>
                        </source>
                        <target>
                           <context value="d"/>
                           <contextType value="variable"/>
                           <element value="low"/>
                           <variable value="l"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="SimpleQuantity"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="low"/>
                           <source>
                              <context value="doseQuant"/>
                              <element value="low"/>
                              <variable value="lo"/>
                           </source>
                           <target>
                              <context value="l"/>
                              <contextType value="variable"/>
                              <element value="value"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="lo.value"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="low"/>
                           <source>
                              <context value="doseQuant"/>
                              <element value="low"/>
                              <variable value="lo"/>
                           </source>
                           <target>
                              <context value="l"/>
                              <contextType value="variable"/>
                              <element value="unit"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="lo.unit"/>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                     <rule>
                        <name value="low"/>
                        <source>
                           <context value="doseQuant"/>
                        </source>
                        <target>
                           <context value="d"/>
                           <contextType value="variable"/>
                           <element value="high"/>
                           <variable value="h"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="SimpleQuantity"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="high"/>
                           <source>
                              <context value="doseQuant"/>
                              <element value="high"/>
                              <variable value="hi"/>
                           </source>
                           <target>
                              <context value="h"/>
                              <contextType value="variable"/>
                              <element value="value"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="hi.value"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="high"/>
                           <source>
                              <context value="doseQuant"/>
                              <element value="high"/>
                              <variable value="hi"/>
                           </source>
                           <target>
                              <context value="h"/>
                              <contextType value="variable"/>
                              <element value="unit"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="hi.unit"/>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="rate"/>
               <source>
                  <context value="src"/>
                  <element value="rateQuantity"/>
                  <variable value="rateQuantity"/>
               </source>
               <rule>
                  <name value="ot"/>
                  <source>
                     <context value="rateQuantity"/>
                     <element value="originalText"/>
                     <variable value="ot"/>
                  </source>
                  <rule>
                     <name value="reference"/>
                     <source>
                        <context value="ot"/>
                        <element value="reference"/>
                        <variable value="vvv"/>
                     </source>
                     <target>
                        <context value="dosageInstruction"/>
                        <contextType value="variable"/>
                        <element value="text"/>
                        <variable value="vvv"/>
                        <transform value="create"/>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="dosageRate"/>
                  <source>
                     <context value="rateQuantity"/>
                  </source>
                  <target>
                     <context value="dosageInstruction"/>
                     <contextType value="variable"/>
                     <element value="doseAndRate"/>
                     <variable value="dosageRate"/>
                  </target>
                  <rule>
                     <name value="r"/>
                     <source>
                        <context value="rateQuantity"/>
                     </source>
                     <target>
                        <context value="dosageRate"/>
                        <contextType value="variable"/>
                        <element value="rate"/>
                        <variable value="d"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Range"/>
                        </parameter>
                     </target>
                     <rule>
                        <name value="low"/>
                        <source>
                           <context value="rateQuantity"/>
                        </source>
                        <target>
                           <context value="d"/>
                           <contextType value="variable"/>
                           <element value="low"/>
                           <variable value="l"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="SimpleQuantity"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="low"/>
                           <source>
                              <context value="rateQuantity"/>
                              <element value="low"/>
                              <variable value="lo"/>
                           </source>
                           <target>
                              <context value="l"/>
                              <contextType value="variable"/>
                              <element value="value"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="lo.value"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="low"/>
                           <source>
                              <context value="rateQuantity"/>
                              <element value="low"/>
                              <variable value="lo"/>
                           </source>
                           <target>
                              <context value="l"/>
                              <contextType value="variable"/>
                              <element value="unit"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="lo.unit"/>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                     <rule>
                        <name value="high"/>
                        <source>
                           <context value="rateQuantity"/>
                        </source>
                        <target>
                           <context value="d"/>
                           <contextType value="variable"/>
                           <element value="high"/>
                           <variable value="h"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="SimpleQuantity"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="high"/>
                           <source>
                              <context value="rateQuantity"/>
                              <element value="high"/>
                              <variable value="hi"/>
                           </source>
                           <target>
                              <context value="h"/>
                              <contextType value="variable"/>
                              <element value="value"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="hi.value"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="high"/>
                           <source>
                              <context value="rateQuantity"/>
                              <element value="high"/>
                              <variable value="hi"/>
                           </source>
                           <target>
                              <context value="h"/>
                              <contextType value="variable"/>
                              <element value="unit"/>
                              <transform value="evaluate"/>
                              <parameter>
                                 <valueString value="hi.unit"/>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="route"/>
               <source>
                  <context value="src"/>
                  <element value="routeCode"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="dosageInstruction"/>
                  <contextType value="variable"/>
                  <element value="route"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="site"/>
               <source>
                  <context value="src"/>
                  <element value="approachSiteCode"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="dosageInstruction"/>
                  <contextType value="variable"/>
                  <element value="site"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="site"/>
               <source>
                  <context value="src"/>
                  <element value="targetSiteCode"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="dosageInstruction"/>
                  <contextType value="variable"/>
                  <element value="site"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="medication"/>
         <source>
            <context value="src"/>
            <element value="consumable"/>
            <variable value="consumable"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e1"/>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="POST"/>
            </parameter>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="medication"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Medication"/>
            </parameter>
         </target>
         <target>
            <context value="medication"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="uuid1"/>
            <transform value="uuid"/>
         </target>
         <target>
            <context value="e1"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
               <valueString value="https://example/Medication/"/>
            </parameter>
            <parameter>
               <valueId value="uuid1"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="Medication"/>
            </parameter>
         </target>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="medication"/>
            <variable value="medref"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="medref"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Medication/' + %medication.id"/>
            </parameter>
         </target>
         <dependent>
            <name value="Medication"/>
            <variable value="src">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="medication">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="patient">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="bundle">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryR"/>
         <source>
            <context value="src"/>
            <element value="entryRelationship"/>
            <variable value="entryRelationship"/>
         </source>
         <rule>
            <name value="supply"/>
            <source>
               <context value="entryRelationship"/>
               <element value="supply"/>
               <variable value="supply"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="dispenseRequest"/>
               <variable value="dispenseRequest"/>
            </target>
            <rule>
               <name value="quantity"/>
               <source>
                  <context value="supply"/>
                  <element value="quantity"/>
                  <variable value="quantityCDA"/>
               </source>
               <target>
                  <context value="dispenseRequest"/>
                  <contextType value="variable"/>
                  <element value="quantity"/>
                  <variable value="quantityFHIR"/>
               </target>
               <rule>
                  <name value="value"/>
                  <source>
                     <context value="quantityCDA"/>
                  </source>
                  <target>
                     <context value="quantityFHIR"/>
                     <contextType value="variable"/>
                     <element value="value"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="quantityCDA.value"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="Partecipant"/>
         <source>
            <context value="src"/>
            <element value="participant"/>
            <variable value="participant"/>
         </source>
         <rule>
            <name value="function"/>
            <source>
               <context value="participant"/>
            </source>
            <dependent>
               <name value="Practitioner"/>
               <variable value="participant">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="tgt">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
               <variable value="bundle">
                  <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                     <valueUrl value="id"/>
                  </extension>
               </variable>
            </dependent>
         </rule>
         <rule>
            <name value="autor"/>
            <source>
               <context value="participant"/>
               <element value="effectiveTime"/>
               <variable value="vvv"/>
            </source>
            <target>
               <context value="tgt"/>
               <contextType value="variable"/>
               <element value="authoredOn"/>
               <variable value="vvv"/>
               <transform value="create"/>
            </target>
         </rule>
      </rule>
   </group>
   <group>
      <name value="periodTiming"/>
      <typeMode value="none"/>
      <input>
         <name value="effectiveTime"/>
         <type value="PIVL_TS"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="timing"/>
         <type value="Timing"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="repeat"/>
         <source>
            <context value="effectiveTime"/>
         </source>
         <target>
            <context value="timing"/>
            <contextType value="variable"/>
            <element value="repeat"/>
            <variable value="r"/>
         </target>
         <rule>
            <name value="period"/>
            <source>
               <context value="effectiveTime"/>
               <element value="period"/>
               <variable value="p"/>
            </source>
            <target>
               <context value="r"/>
               <contextType value="variable"/>
               <element value="period"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="p.value"/>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="period"/>
            <source>
               <context value="effectiveTime"/>
               <element value="period"/>
               <variable value="p"/>
            </source>
            <target>
               <context value="r"/>
               <contextType value="variable"/>
               <element value="periodUnit"/>
               <transform value="evaluate"/>
               <parameter>
                  <valueString value="p.unit"/>
               </parameter>
            </target>
         </rule>
      </rule>
   </group>
   <group>
      <name value="Medication"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="cda"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="Medication"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="consumable"/>
         <source>
            <context value="src"/>
            <element value="consumable"/>
            <variable value="consumable"/>
         </source>
         <rule>
            <name value="product"/>
            <source>
               <context value="consumable"/>
               <element value="manufacturedProduct"/>
               <variable value="manufacturedProduct"/>
            </source>
            <rule>
               <name value="material"/>
               <source>
                  <context value="manufacturedProduct"/>
                  <element value="manufacturedMaterial"/>
                  <variable value="manufacturedMaterial"/>
               </source>
               <rule>
                  <name value="CE"/>
                  <source>
                     <context value="manufacturedMaterial"/>
                     <element value="code"/>
                     <variable value="vvv"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="code"/>
                     <variable value="vvv"/>
                     <transform value="create"/>
                  </target>
               </rule>
               <rule>
                  <name value="form"/>
                  <source>
                     <context value="src"/>
                     <element value="administrationUnitCode"/>
                     <variable value="vvv"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="form"/>
                     <variable value="vvv"/>
                     <transform value="create"/>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="entryR"/>
         <source>
            <context value="src"/>
            <element value="entryRelationship"/>
            <variable value="entryR"/>
         </source>
         <rule>
            <name value="obs"/>
            <source>
               <context value="entryR"/>
               <element value="observation"/>
               <variable value="observation"/>
            </source>
            <rule>
               <name value="ingredient"/>
               <source>
                  <context value="observation"/>
                  <element value="code"/>
                  <condition value="displayName = 'Grammatura'"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="ingredient"/>
                  <variable value="ingredient"/>
               </target>
               <rule>
                  <name value="consumable"/>
                  <source>
                     <context value="src"/>
                     <element value="consumable"/>
                     <variable value="consumable"/>
                  </source>
                  <rule>
                     <name value="product"/>
                     <source>
                        <context value="consumable"/>
                        <element value="manufacturedProduct"/>
                        <variable value="manufacturedProduct"/>
                     </source>
                     <rule>
                        <name value="material"/>
                        <source>
                           <context value="manufacturedProduct"/>
                           <element value="manufacturedMaterial"/>
                           <variable value="manufacturedMaterial"/>
                        </source>
                        <rule>
                           <name value="CE"/>
                           <source>
                              <context value="manufacturedMaterial"/>
                              <element value="code"/>
                              <variable value="code"/>
                           </source>
                           <target>
                              <context value="ingredient"/>
                              <contextType value="variable"/>
                              <element value="item"/>
                              <variable value="value"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="CodeableConcept"/>
                              </parameter>
                           </target>
                           <dependent>
                              <name value="CECodeableConcept"/>
                              <variable value="code">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="value">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                           </dependent>
                        </rule>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="strenght"/>
                  <source>
                     <context value="observation"/>
                     <element value="value"/>
                     <variable value="value"/>
                  </source>
                  <target>
                     <context value="ingredient"/>
                     <contextType value="variable"/>
                     <element value="strength"/>
                     <variable value="strength"/>
                  </target>
                  <rule>
                     <name value="numerator"/>
                     <source>
                        <context value="value"/>
                     </source>
                     <target>
                        <context value="strength"/>
                        <contextType value="variable"/>
                        <element value="numerator"/>
                        <variable value="numerator"/>
                     </target>
                     <rule>
                        <name value="valueN"/>
                        <source>
                           <context value="value"/>
                        </source>
                        <target>
                           <context value="numerator"/>
                           <contextType value="variable"/>
                           <element value="value"/>
                           <transform value="evaluate"/>
                           <parameter>
                              <valueString value="value.value"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
                  <rule>
                     <name value="denominator"/>
                     <source>
                        <context value="value"/>
                     </source>
                     <target>
                        <context value="strength"/>
                        <contextType value="variable"/>
                        <element value="denominator"/>
                        <variable value="denominator"/>
                     </target>
                     <rule>
                        <name value="valueD"/>
                        <source>
                           <context value="value"/>
                        </source>
                        <target>
                           <context value="denominator"/>
                           <contextType value="variable"/>
                           <element value="value"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueInteger value="1"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="quantita"/>
               <source>
                  <context value="observation"/>
                  <element value="code"/>
                  <condition value="displayName = 'Quantit nella Confezione'"/>
               </source>
               <rule>
                  <name value="amount"/>
                  <source>
                     <context value="observation"/>
                     <element value="value"/>
                     <variable value="value"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="amount"/>
                     <variable value="amount"/>
                  </target>
                  <rule>
                     <name value="numerator"/>
                     <source>
                        <context value="value"/>
                     </source>
                     <target>
                        <context value="amount"/>
                        <contextType value="variable"/>
                        <element value="numerator"/>
                        <variable value="numerator"/>
                     </target>
                     <rule>
                        <name value="valueN"/>
                        <source>
                           <context value="value"/>
                        </source>
                        <target>
                           <context value="numerator"/>
                           <contextType value="variable"/>
                           <element value="value"/>
                           <transform value="evaluate"/>
                           <parameter>
                              <valueString value="value.value"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
                  <rule>
                     <name value="denominator"/>
                     <source>
                        <context value="value"/>
                     </source>
                     <target>
                        <context value="amount"/>
                        <contextType value="variable"/>
                        <element value="denominator"/>
                        <variable value="denominator"/>
                     </target>
                     <rule>
                        <name value="valueD"/>
                        <source>
                           <context value="value"/>
                        </source>
                        <target>
                           <context value="denominator"/>
                           <contextType value="variable"/>
                           <element value="value"/>
                           <transform value="copy"/>
                           <parameter>
                              <valueInteger value="1"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="MedicationStatement"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="subAdmin"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="MedicationStatement"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="Patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="Encounter"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="subject"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="statusCode"/>
         <source>
            <context value="src"/>
            <element value="statusCode"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="notpresent"/>
         <source>
            <context value="src"/>
            <condition value="statusCode.exists().not()"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="unknown"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="consumable"/>
         <source>
            <context value="src"/>
            <element value="consumable"/>
            <variable value="consumable"/>
         </source>
         <rule>
            <name value="product"/>
            <source>
               <context value="consumable"/>
               <element value="manufacturedProduct"/>
               <variable value="manufacturedProduct"/>
            </source>
            <rule>
               <name value="material"/>
               <source>
                  <context value="manufacturedProduct"/>
                  <element value="manufacturedMaterial"/>
                  <variable value="manufacturedMaterial"/>
               </source>
               <rule>
                  <name value="CE"/>
                  <source>
                     <context value="manufacturedMaterial"/>
                     <element value="code"/>
                     <variable value="code"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="medication"/>
                     <variable value="ce"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="CodeableConcept"/>
                     </parameter>
                  </target>
                  <dependent>
                     <name value="CECodeableConcept"/>
                     <variable value="code">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                     <variable value="ce">
                        <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                           <valueUrl value="id"/>
                        </extension>
                     </variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="FamilyMemberFunction"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="organizer"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="FamilyMemberHistory"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="patient"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="patReference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="patient"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="statusCode"/>
         <source>
            <context value="src"/>
            <element value="statusCode"/>
            <variable value="vvv"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="status"/>
            <variable value="vvv"/>
            <transform value="create"/>
         </target>
      </rule>
      <rule>
         <name value="date"/>
         <source>
            <context value="src"/>
            <element value="effectiveTime"/>
            <variable value="effectiveTime"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="date"/>
            <variable value="value"/>
            <transform value="create"/>
            <parameter>
               <valueString value="date"/>
            </parameter>
         </target>
         <dependent>
            <name value="TSDateTime"/>
            <variable value="effectiveTime">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
            <variable value="value">
               <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                  <valueUrl value="id"/>
               </extension>
            </variable>
         </dependent>
      </rule>
      <rule>
         <name value="relationship"/>
         <source>
            <context value="src"/>
            <element value="subject"/>
            <variable value="subject"/>
         </source>
         <rule>
            <name value="relatedSub"/>
            <source>
               <context value="subject"/>
               <element value="relatedSubject"/>
               <variable value="relatedSubject"/>
            </source>
            <rule>
               <name value="relationshipCode"/>
               <source>
                  <context value="relatedSubject"/>
                  <element value="code"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="relationship"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="subject"/>
               <source>
                  <context value="relatedSubject"/>
                  <element value="subject"/>
                  <variable value="subject"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="sex"/>
                  <variable value="sex"/>
               </target>
               <rule>
                  <name value="coding"/>
                  <source>
                     <context value="subject"/>
                     <element value="administrativeGenderCode"/>
                     <variable value="administrativeGenderCode"/>
                  </source>
                  <target>
                     <context value="sex"/>
                     <contextType value="variable"/>
                     <element value="coding"/>
                     <variable value="coding"/>
                  </target>
                  <rule>
                     <name value="gender"/>
                     <source>
                        <context value="administrativeGenderCode"/>
                        <element value="code"/>
                        <variable value="sexCode"/>
                     </source>
                     <target>
                        <context value="coding"/>
                        <contextType value="variable"/>
                        <element value="code"/>
                        <transform value="translate"/>
                        <parameter>
                           <valueId value="sexCode"/>
                        </parameter>
                        <parameter>
                           <valueString value="#cm-v3-administrative-gender"/>
                        </parameter>
                        <parameter>
                           <valueString value="code"/>
                        </parameter>
                     </target>
                  </rule>
                  <rule>
                     <name value="system"/>
                     <source>
                        <context value="administrativeGenderCode"/>
                     </source>
                     <target>
                        <context value="coding"/>
                        <contextType value="variable"/>
                        <element value="system"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="http://hl7.org/fhir/administrative-gender"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="component"/>
         <source>
            <context value="src"/>
            <element value="component"/>
            <variable value="component"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="condition"/>
            <variable value="condition"/>
         </target>
         <rule>
            <name value="observation"/>
            <source>
               <context value="component"/>
               <element value="observation"/>
               <variable value="observation"/>
            </source>
            <rule>
               <name value="code"/>
               <source>
                  <context value="observation"/>
                  <element value="code"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="condition"/>
                  <contextType value="variable"/>
                  <element value="code"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="reference"/>
               <source>
                  <context value="observation"/>
                  <element value="text"/>
                  <variable value="text"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="note"/>
                  <variable value="note"/>
               </target>
               <rule>
                  <name value="value"/>
                  <source>
                     <context value="text"/>
                     <element value="reference"/>
                     <variable value="reference"/>
                  </source>
                  <target>
                     <context value="note"/>
                     <contextType value="variable"/>
                     <element value="text"/>
                     <transform value="evaluate"/>
                     <parameter>
                        <valueString value="reference.value"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="statusCode"/>
               <source>
                  <context value="observation"/>
                  <element value="statusCode"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="status"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="cont"/>
               <source>
                  <context value="observation"/>
                  <condition value="observation.effectiveTime.exists()"/>
               </source>
               <rule>
                  <name value="effttemp"/>
                  <source>
                     <context value="observation"/>
                     <element value="effectiveTime"/>
                     <variable value="effectiveTime"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="condition"/>
                     <variable value="condition"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="BackboneElement"/>
                     </parameter>
                  </target>
                  <rule>
                     <name value="code"/>
                     <source>
                        <context value="observation"/>
                        <element value="code"/>
                        <variable value="vvv"/>
                     </source>
                     <target>
                        <context value="condition"/>
                        <contextType value="variable"/>
                        <element value="code"/>
                        <variable value="vvv"/>
                        <transform value="create"/>
                     </target>
                  </rule>
                  <rule>
                     <name value="codeable"/>
                     <source>
                        <context value="observation"/>
                        <element value="value"/>
                        <variable value="vvv"/>
                     </source>
                     <target>
                        <context value="condition"/>
                        <contextType value="variable"/>
                        <element value="outcome"/>
                        <variable value="vvv"/>
                        <transform value="create"/>
                     </target>
                  </rule>
                  <rule>
                     <name value="efft"/>
                     <source>
                        <context value="effectiveTime"/>
                     </source>
                     <target>
                        <context value="condition"/>
                        <contextType value="variable"/>
                        <element value="onset"/>
                        <variable value="period"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Period"/>
                        </parameter>
                     </target>
                     <rule>
                        <name value="val"/>
                        <source>
                           <context value="effectiveTime"/>
                        </source>
                        <target>
                           <context value="period"/>
                           <contextType value="variable"/>
                           <element value="start"/>
                           <variable value="start"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="dateTime"/>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="TSDateTime"/>
                           <variable value="effectiveTime">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="start">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                        </dependent>
                     </rule>
                  </rule>
               </rule>
               <documentation value="observation.effectiveTime as effectiveTime -> condition.onset = create('Period') as value then IVLTSPeriod(effectiveTime, value) &quot;valuePeriod&quot;;"/>
            </rule>
            <rule>
               <name value="codeable"/>
               <source>
                  <context value="observation"/>
                  <element value="value"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="condition"/>
                  <contextType value="variable"/>
                  <element value="outcome"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="EntryRel"/>
               <source>
                  <context value="observation"/>
                  <element value="entryRelationship"/>
                  <variable value="entryR"/>
               </source>
               <rule>
                  <name value="obser"/>
                  <source>
                     <context value="entryR"/>
                     <element value="observation"/>
                     <variable value="obs"/>
                  </source>
                  <rule>
                     <name value="insorgenza"/>
                     <source>
                        <context value="obs"/>
                        <condition value="(code.code = '35267-4')"/>
                     </source>
                     <rule>
                        <name value="value"/>
                        <source>
                           <context value="obs"/>
                           <element value="value"/>
                           <variable value="value"/>
                        </source>
                        <target>
                           <context value="condition"/>
                           <contextType value="variable"/>
                           <element value="onset"/>
                           <variable value="Age"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="Age"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="age"/>
                           <source>
                              <context value="value"/>
                              <element value="value"/>
                              <variable value="valueAge"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="value"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueId value="valueAge"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="unit"/>
                           <source>
                              <context value="value"/>
                              <element value="unit"/>
                              <variable value="unit"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="code"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueId value="unit"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="unit"/>
                           <source>
                              <context value="value"/>
                              <element value="unit"/>
                              <variable value="unit"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="unit"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueId value="unit"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="system"/>
                           <source>
                              <context value="value"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="system"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="http://unitsofmeasure.org"/>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                  </rule>
                  <rule>
                     <name value="death"/>
                     <source>
                        <context value="obs"/>
                        <condition value="(code.code = '39016-1')"/>
                     </source>
                     <rule>
                        <name value="value"/>
                        <source>
                           <context value="obs"/>
                           <element value="value"/>
                           <variable value="value"/>
                        </source>
                        <target>
                           <context value="tgt"/>
                           <contextType value="variable"/>
                           <element value="deceased"/>
                           <variable value="Age"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="Age"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="age"/>
                           <source>
                              <context value="value"/>
                              <element value="value"/>
                              <variable value="valueAge"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="value"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueId value="valueAge"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="unit"/>
                           <source>
                              <context value="value"/>
                              <element value="unit"/>
                              <variable value="unit"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="code"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueId value="unit"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="unit"/>
                           <source>
                              <context value="value"/>
                              <element value="unit"/>
                              <variable value="unit"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="unit"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueId value="unit"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="system"/>
                           <source>
                              <context value="value"/>
                           </source>
                           <target>
                              <context value="Age"/>
                              <contextType value="variable"/>
                              <element value="system"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="http://unitsofmeasure.org"/>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="allergyFunction"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="cdaElement"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="AllergyIntolerance"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="patient"/>
         <type value="patient"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="encounter"/>
         <type value="encounter"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="patient"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Patient/' + %patient.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="reference"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="tgt"/>
            <contextType value="variable"/>
            <element value="encounter"/>
            <variable value="reference"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Reference"/>
            </parameter>
         </target>
         <target>
            <context value="reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="evaluate"/>
            <parameter>
               <valueString value="'https://example/Encounter/' + %encounter.id"/>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="entryrelationship"/>
         <source>
            <context value="src"/>
            <element value="entryRelationship"/>
            <variable value="entryRelationship1"/>
         </source>
         <rule>
            <name value="observation"/>
            <source>
               <context value="entryRelationship1"/>
               <element value="observation"/>
               <variable value="observation1"/>
            </source>
            <rule>
               <name value="valuePeriod"/>
               <source>
                  <context value="observation1"/>
                  <element value="effectiveTime"/>
                  <variable value="effectiveTime"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="onset"/>
                  <variable value="value"/>
                  <transform value="create"/>
                  <parameter>
                     <valueString value="Period"/>
                  </parameter>
               </target>
               <dependent>
                  <name value="IVLTSPeriod"/>
                  <variable value="effectiveTime">
                     <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                        <valueUrl value="id"/>
                     </extension>
                  </variable>
                  <variable value="value">
                     <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                        <valueUrl value="id"/>
                     </extension>
                  </variable>
               </dependent>
            </rule>
            <rule>
               <name value="code"/>
               <source>
                  <context value="observation1"/>
                  <element value="value"/>
                  <variable value="code"/>
               </source>
               <rule>
                  <name value="type"/>
                  <source>
                     <context value="code"/>
                     <element value="code"/>
                     <variable value="code1"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="type"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="code1"/>
                     </parameter>
                     <parameter>
                        <valueString value="#AllergyTypeMap"/>
                     </parameter>
                     <parameter>
                        <valueString value="code"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="category"/>
                  <source>
                     <context value="code"/>
                     <element value="code"/>
                     <variable value="code1"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="category"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="code1"/>
                     </parameter>
                     <parameter>
                        <valueString value="#AllergyCategoryMap"/>
                     </parameter>
                     <parameter>
                        <valueString value="code"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="participant"/>
               <source>
                  <context value="observation1"/>
                  <element value="participant"/>
                  <variable value="participant"/>
               </source>
               <target>
                  <context value="tgt"/>
                  <contextType value="variable"/>
                  <element value="reaction"/>
                  <variable value="reaction"/>
               </target>
               <rule>
                  <name value="entryR2"/>
                  <source>
                     <context value="observation1"/>
                     <element value="entryRelationship"/>
                     <variable value="entryRelationship2"/>
                     <condition value="(typeCode = 'MFST')"/>
                  </source>
                  <rule>
                     <name value="observ2"/>
                     <source>
                        <context value="entryRelationship2"/>
                        <element value="observation"/>
                        <variable value="observation2"/>
                     </source>
                     <rule>
                        <name value="manifestation"/>
                        <source>
                           <context value="observation2"/>
                           <element value="value"/>
                           <variable value="vvv"/>
                        </source>
                        <target>
                           <context value="reaction"/>
                           <contextType value="variable"/>
                           <element value="manifestation"/>
                           <variable value="vvv"/>
                           <transform value="create"/>
                        </target>
                     </rule>
                     <rule>
                        <name value="low"/>
                        <source>
                           <context value="observation2"/>
                           <element value="effectiveTime"/>
                           <variable value="effectiveTime"/>
                        </source>
                        <rule>
                           <name value="valuePeriodLow"/>
                           <source>
                              <context value="effectiveTime"/>
                              <element value="low"/>
                              <variable value="low"/>
                           </source>
                           <target>
                              <context value="reaction"/>
                              <contextType value="variable"/>
                              <element value="onset"/>
                              <variable value="value"/>
                              <transform value="create"/>
                              <parameter>
                                 <valueString value="dateTime"/>
                              </parameter>
                           </target>
                           <dependent>
                              <name value="TSDateTime"/>
                              <variable value="low">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                              <variable value="value">
                                 <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                    <valueUrl value="id"/>
                                 </extension>
                              </variable>
                           </dependent>
                        </rule>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="participantRole"/>
                  <source>
                     <context value="participant"/>
                     <element value="participantRole"/>
                     <variable value="participantRole"/>
                  </source>
                  <rule>
                     <name value="playingEntity"/>
                     <source>
                        <context value="participantRole"/>
                        <element value="playingEntity"/>
                        <variable value="playingEntity"/>
                     </source>
                     <rule>
                        <name value="reaction"/>
                        <source>
                           <context value="playingEntity"/>
                           <element value="code"/>
                           <variable value="vvv"/>
                        </source>
                        <target>
                           <context value="reaction"/>
                           <contextType value="variable"/>
                           <element value="substance"/>
                           <variable value="vvv"/>
                           <transform value="create"/>
                        </target>
                     </rule>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="entryR2"/>
               <source>
                  <context value="observation1"/>
                  <element value="entryRelationship"/>
                  <variable value="entryRelationship2"/>
                  <condition value="(typeCode = 'MFST')"/>
               </source>
               <rule>
                  <name value="observ2"/>
                  <source>
                     <context value="entryRelationship2"/>
                     <element value="observation"/>
                     <variable value="observation2"/>
                     <condition value="observation1.participant.exists().not()"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="reaction"/>
                     <variable value="reaction"/>
                  </target>
                  <rule>
                     <name value="manifestation"/>
                     <source>
                        <context value="observation2"/>
                        <element value="value"/>
                        <variable value="vvv"/>
                     </source>
                     <target>
                        <context value="reaction"/>
                        <contextType value="variable"/>
                        <element value="manifestation"/>
                        <variable value="vvv"/>
                        <transform value="create"/>
                     </target>
                  </rule>
                  <rule>
                     <name value="low"/>
                     <source>
                        <context value="observation2"/>
                        <element value="effectiveTime"/>
                        <variable value="effectiveTime"/>
                     </source>
                     <rule>
                        <name value="valuePeriodLow"/>
                        <source>
                           <context value="effectiveTime"/>
                           <element value="low"/>
                           <variable value="low"/>
                        </source>
                        <target>
                           <context value="reaction"/>
                           <contextType value="variable"/>
                           <element value="onset"/>
                           <variable value="value"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="dateTime"/>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="TSDateTime"/>
                           <variable value="low">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                           <variable value="value">
                              <extension url="http://hl7.org/fhir/tools/StructureDefinition/original-item-type">
                                 <valueUrl value="id"/>
                              </extension>
                           </variable>
                        </dependent>
                     </rule>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="entryR3"/>
               <source>
                  <context value="observation1"/>
                  <element value="entryRelationship"/>
                  <variable value="entryRelationship3"/>
                  <condition value="(typeCode = 'SUBJ')"/>
               </source>
               <rule>
                  <name value="observ3"/>
                  <source>
                     <context value="entryRelationship3"/>
                     <element value="observation"/>
                     <variable value="observation3"/>
                  </source>
                  <rule>
                     <name value="criticality"/>
                     <source>
                        <context value="observation3"/>
                        <element value="value"/>
                        <variable value="value"/>
                     </source>
                     <rule>
                        <name value="value"/>
                        <source>
                           <context value="value"/>
                           <element value="code"/>
                           <variable value="c"/>
                        </source>
                        <target>
                           <context value="tgt"/>
                           <contextType value="variable"/>
                           <element value="criticality"/>
                           <transform value="translate"/>
                           <parameter>
                              <valueId value="c"/>
                           </parameter>
                           <parameter>
                              <valueString value="#CricalityMap"/>
                           </parameter>
                           <parameter>
                              <valueString value="code"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="act"/>
                  <source>
                     <context value="entryRelationship3"/>
                     <element value="act"/>
                     <variable value="act"/>
                  </source>
                  <target>
                     <context value="tgt"/>
                     <contextType value="variable"/>
                     <element value="note"/>
                     <variable value="note"/>
                  </target>
                  <rule>
                     <name value="note"/>
                     <source>
                        <context value="act"/>
                        <element value="text"/>
                        <variable value="text"/>
                     </source>
                     <rule>
                        <name value="reference"/>
                        <source>
                           <context value="text"/>
                           <element value="reference"/>
                           <variable value="reference"/>
                        </source>
                        <target>
                           <context value="note"/>
                           <contextType value="variable"/>
                           <element value="text"/>
                           <transform value="evaluate"/>
                           <parameter>
                              <valueString value="reference.value"/>
                           </parameter>
                        </target>
                     </rule>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="entryR4"/>
               <source>
                  <context value="observation1"/>
                  <element value="entryRelationship"/>
                  <variable value="entryRelationship4"/>
                  <condition value="(typeCode = 'REFR')"/>
               </source>
               <rule>
                  <name value="observ4"/>
                  <source>
                     <context value="entryRelationship4"/>
                     <element value="observation"/>
                     <variable value="observation4"/>
                  </source>
                  <rule>
                     <name value="clinicalStatus"/>
                     <source>
                        <context value="observation4"/>
                        <element value="value"/>
                        <variable value="value"/>
                     </source>
                     <target>
                        <context value="tgt"/>
                        <contextType value="variable"/>
                        <element value="clinicalStatus"/>
                        <variable value="clinicalStatus"/>
                     </target>
                     <rule>
                        <name value="coding"/>
                        <source>
                           <context value="value"/>
                           <variable value="valu"/>
                        </source>
                        <target>
                           <context value="clinicalStatus"/>
                           <contextType value="variable"/>
                           <element value="coding"/>
                           <variable value="coding"/>
                           <transform value="create"/>
                           <parameter>
                              <valueString value="Coding"/>
                           </parameter>
                        </target>
                        <rule>
                           <name value="code"/>
                           <source>
                              <context value="valu"/>
                              <condition value="(code = 'LA9041-0')"/>
                           </source>
                           <target>
                              <context value="coding"/>
                              <contextType value="variable"/>
                              <element value="code"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="resolved"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="code"/>
                           <source>
                              <context value="valu"/>
                              <condition value="(code = 'LA18632-2')"/>
                           </source>
                           <target>
                              <context value="coding"/>
                              <contextType value="variable"/>
                              <element value="code"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="inactive"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="code"/>
                           <source>
                              <context value="valu"/>
                              <condition value="(code = 'LA16666-2')"/>
                           </source>
                           <target>
                              <context value="coding"/>
                              <contextType value="variable"/>
                              <element value="code"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="active"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="system"/>
                           <source>
                              <context value="valu"/>
                           </source>
                           <target>
                              <context value="coding"/>
                              <contextType value="variable"/>
                              <element value="system"/>
                              <transform value="copy"/>
                              <parameter>
                                 <valueString value="http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical"/>
                              </parameter>
                           </target>
                        </rule>
                        <rule>
                           <name value="display"/>
                           <source>
                              <context value="valu"/>
                              <element value="displayName"/>
                              <variable value="display"/>
                           </source>
                           <target>
                              <context value="coding"/>
                              <contextType value="variable"/>
                              <element value="display"/>
                              <transform value="cast"/>
                              <parameter>
                                 <valueId value="display"/>
                              </parameter>
                              <parameter>
                                 <valueString value="string"/>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="Practitioner"/>
      <typeMode value="none"/>
      <input>
         <name value="src"/>
         <type value="participant"/>
         <mode value="source"/>
      </input>
      <input>
         <name value="tgt"/>
         <type value="MedicationRequest"/>
         <mode value="target"/>
      </input>
      <input>
         <name value="bundle"/>
         <type value="Bundle"/>
         <mode value="target"/>
      </input>
      <rule>
         <name value="practitionerCreate"/>
         <source>
            <context value="src"/>
         </source>
         <target>
            <context value="bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="e22"/>
         </target>
         <target>
            <context value="e22"/>
            <contextType value="variable"/>
            <element value="request"/>
            <variable value="request"/>
            <transform value="create"/>
            <parameter>
               <valueString value="BackboneElement"/>
            </parameter>
         </target>
         <target>
            <context value="request"/>
            <contextType value="variable"/>
            <element value="method"/>
            <transform value="copy"/>
            <parameter>
               <valueString value="PUT"/>
            </parameter>
         </target>
         <target>
            <context value="e22"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="practitioner1"/>
            <transform value="create"/>
            <parameter>
               <valueString value="Practitioner"/>
            </parameter>
         </target>
         <rule>
            <name value="resurceCreation"/>
            <source>
               <context value="src"/>
               <element value="participantRole"/>
               <variable value="practr"/>
            </source>
            <rule>
               <name value="identifier"/>
               <source>
                  <context value="practr"/>
                  <element value="id"/>
                  <variable value="id"/>
               </source>
               <target>
                  <context value="practitioner1"/>
                  <contextType value="variable"/>
                  <element value="identifier"/>
                  <variable value="identifier"/>
               </target>
               <rule>
                  <name value="root1"/>
                  <source>
                     <context value="id"/>
                     <element value="root"/>
                     <variable value="r"/>
                  </source>
                  <target>
                     <context value="identifier"/>
                     <contextType value="variable"/>
                     <element value="system"/>
                     <transform value="translate"/>
                     <parameter>
                        <valueId value="r"/>
                     </parameter>
                     <parameter>
                        <valueString value="http://hl7.org/fhir/ConceptMap/special-oid2uri"/>
                     </parameter>
                     <parameter>
                        <valueString value="uri"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="ext"/>
                  <source>
                     <context value="id"/>
                     <element value="extension"/>
                     <variable value="ext"/>
                  </source>
                  <target>
                     <context value="identifier"/>
                     <contextType value="variable"/>
                     <element value="value"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueId value="ext"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="assigningAuthorityName"/>
                  <source>
                     <context value="id"/>
                     <element value="assigningAuthorityName"/>
                     <variable value="s"/>
                  </source>
                  <target>
                     <context value="identifier"/>
                     <contextType value="variable"/>
                     <element value="assigner"/>
                     <variable value="a"/>
                  </target>
                  <target>
                     <context value="a"/>
                     <contextType value="variable"/>
                     <element value="display"/>
                     <transform value="copy"/>
                     <parameter>
                        <valueId value="s"/>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="r"/>
                  <source>
                     <context value="id"/>
                     <element value="root"/>
                     <variable value="r"/>
                  </source>
                  <rule>
                     <name value="id"/>
                     <source>
                        <context value="id"/>
                        <element value="extension"/>
                        <variable value="ext"/>
                     </source>
                     <target>
                        <context value="practitioner1"/>
                        <contextType value="variable"/>
                        <element value="id"/>
                        <variable value="uuid22"/>
                        <transform value="evaluate"/>
                        <parameter>
                           <valueString value="r + '-' + ext"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="e22"/>
                        <contextType value="variable"/>
                        <element value="fullUrl"/>
                        <transform value="append"/>
                        <parameter>
                           <valueString value="https://example/Practitioner/"/>
                        </parameter>
                        <parameter>
                           <valueId value="uuid22"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="tgt"/>
                        <contextType value="variable"/>
                        <element value="requester"/>
                        <variable value="reference"/>
                        <transform value="create"/>
                        <parameter>
                           <valueString value="Reference"/>
                        </parameter>
                     </target>
                     <target>
                        <context value="reference"/>
                        <contextType value="variable"/>
                        <element value="reference"/>
                        <transform value="evaluate"/>
                        <parameter>
                           <valueString value="'https://example/Practitioner/' + %practitioner1.id"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="2.16.840.1.113883.2.9.4.3.2"/>
               <source>
                  <context value="practr"/>
                  <element value="id"/>
                  <variable value="id"/>
                  <condition value="(root = '2.16.840.1.113883.2.9.4.3.2')"/>
               </source>
               <rule>
                  <name value="UUID"/>
                  <source>
                     <context value="id"/>
                     <element value="extension"/>
                     <variable value="ext"/>
                  </source>
                  <target>
                     <context value="request"/>
                     <contextType value="variable"/>
                     <element value="url"/>
                     <transform value="append"/>
                     <parameter>
                        <valueString value="Practitioner?identifier="/>
                     </parameter>
                     <parameter>
                        <valueId value="ext"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="diverso"/>
               <source>
                  <context value="practr"/>
                  <element value="id"/>
                  <variable value="id"/>
                  <condition value="(root != '2.16.840.1.113883.2.9.4.3.2')"/>
               </source>
               <rule>
                  <name value="UUID"/>
                  <source>
                     <context value="id"/>
                     <element value="extension"/>
                     <variable value="ext"/>
                  </source>
                  <target>
                     <context value="request"/>
                     <contextType value="variable"/>
                     <element value="url"/>
                     <transform value="append"/>
                     <parameter>
                        <valueString value="Practitioner?identifier="/>
                     </parameter>
                     <parameter>
                        <valueId value="ext"/>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="meta"/>
               <source>
                  <context value="practr"/>
               </source>
               <target>
                  <context value="practitioner1"/>
                  <contextType value="variable"/>
                  <element value="meta"/>
                  <variable value="meta"/>
               </target>
               <rule>
                  <name value="coding"/>
                  <source>
                     <context value="practr"/>
                  </source>
                  <target>
                     <context value="meta"/>
                     <contextType value="variable"/>
                     <element value="tag"/>
                     <variable value="coding"/>
                     <transform value="create"/>
                     <parameter>
                        <valueString value="Coding"/>
                     </parameter>
                  </target>
                  <rule>
                     <name value="system"/>
                     <source>
                        <context value="practr"/>
                     </source>
                     <target>
                        <context value="coding"/>
                        <contextType value="variable"/>
                        <element value="system"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="http://algoritmodiscoring"/>
                        </parameter>
                     </target>
                  </rule>
                  <rule>
                     <name value="code"/>
                     <source>
                        <context value="practr"/>
                     </source>
                     <target>
                        <context value="coding"/>
                        <contextType value="variable"/>
                        <element value="code"/>
                        <transform value="copy"/>
                        <parameter>
                           <valueString value="ClinicalDocument/body/TerapiaFarmacologicaConsigliata/participant"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
            <rule>
               <name value="addr"/>
               <source>
                  <context value="practr"/>
                  <element value="addr"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="practitioner1"/>
                  <contextType value="variable"/>
                  <element value="address"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="telecom"/>
               <source>
                  <context value="practr"/>
                  <element value="telecom"/>
                  <variable value="vvv"/>
               </source>
               <target>
                  <context value="practitioner1"/>
                  <contextType value="variable"/>
                  <element value="telecom"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
               </target>
            </rule>
            <rule>
               <name value="partname"/>
               <source>
                  <context value="practr"/>
                  <element value="playingEntity"/>
                  <variable value="plentity"/>
               </source>
               <rule>
                  <name value="name"/>
                  <source>
                     <context value="plentity"/>
                     <element value="name"/>
                     <variable value="vvv"/>
                  </source>
                  <target>
                     <context value="practitioner1"/>
                     <contextType value="variable"/>
                     <element value="name"/>
                     <variable value="vvv"/>
                     <transform value="create"/>
                  </target>
               </rule>
               <rule>
                  <name value="birth"/>
                  <source>
                     <context value="plentity"/>
                     <element value="birthTime"/>
                     <variable value="birthTime"/>
                  </source>
                  <rule>
                     <name value="value"/>
                     <source>
                        <context value="birthTime"/>
                        <element value="value"/>
                        <variable value="date"/>
                     </source>
                     <target>
                        <context value="practitioner1"/>
                        <contextType value="variable"/>
                        <element value="birthDate"/>
                        <transform value="truncate"/>
                        <parameter>
                           <valueId value="date"/>
                        </parameter>
                        <parameter>
                           <valueInteger value="10"/>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
</StructureMap>